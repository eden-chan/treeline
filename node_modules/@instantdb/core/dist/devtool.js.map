{"version":3,"file":"devtool.js","sourceRoot":"","sources":["../src/devtool.ts"],"names":[],"mappings":"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","sourcesContent":["type Devtool = { dispose: () => void };\n\nlet currentDevtool: Devtool | undefined;\n\nexport function createDevtool(appId: string) {\n  currentDevtool?.dispose();\n\n  const container = createContainer();\n  const toggler = createToggler(toggleView);\n  const iframe = createIframe(getSrc(appId));\n\n  function onPostMessage(event: MessageEvent) {\n    if (event.source !== iframe.element.contentWindow) return;\n\n    if (event.data?.type === \"close\" && container.isVisible()) {\n      toggleView();\n    }\n  }\n\n  function onKeyDown(event: KeyboardEvent) {\n    const isToggleShortcut =\n      event.shiftKey && event.ctrlKey && event.key === \"0\";\n    const isEsc = event.key === \"Escape\" || event.key === \"Esc\";\n\n    if (isToggleShortcut || isEsc) {\n      toggleView();\n    }\n  }\n\n  function toggleView() {\n    if (container.isVisible()) {\n      container.element.style.display = \"none\";\n    } else {\n      container.element.style.display = \"block\";\n\n      // lazily render iframe on first open\n      if (!container.element.contains(iframe.element)) {\n        container.element.appendChild(iframe.element);\n      }\n    }\n  }\n\n  function dispose() {\n    container.element.remove();\n    toggler.element.remove();\n    removeEventListener(\"keydown\", onKeyDown);\n    removeEventListener(\"message\", onPostMessage);\n  }\n\n  function create() {\n    document.body.appendChild(container.element);\n    document.body.appendChild(toggler.element);\n    addEventListener(\"keydown\", onKeyDown);\n    addEventListener(\"message\", onPostMessage);\n\n    currentDevtool = {\n      dispose,\n    };\n  }\n\n  return create();\n}\n\nfunction getSrc(appId: string) {\n  const isDev = (window as any).DEV_DEVTOOL;\n\n  const src = `${isDev ? \"http://localhost:3000\" : \"https://instantdb.com\"}/_devtool?appId=${appId}`;\n  return src;\n}\n\nfunction createIframe(src: string) {\n  const element = document.createElement(\"iframe\");\n\n  element.src = src;\n  Object.assign(element.style, {\n    width: \"100%\",\n    height: \"100%\",\n    borderRadius: \"4px\",\n    backgroundColor: \"white\",\n    border: \"none\",\n  } as Partial<CSSStyleDeclaration>);\n  return { element };\n}\n\nfunction createToggler(onClick) {\n  const logoSVG = `\n    <svg width=\"32\" height=\"32\" viewBox=\"0 0 512 512\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n      <rect width=\"512\" height=\"512\" fill=\"black\"/>\n      <rect x=\"97.0973\" y=\"91.3297\" width=\"140\" height=\"330\" fill=\"white\"/>\n    </svg>\n  `;\n  const element = document.createElement(\"button\");\n  element.innerHTML = logoSVG;\n  Object.assign(element.style, {\n    // pos\n    position: \"fixed\",\n    bottom: \"24px\",\n    left: \"24px\",\n    height: \"32px\",\n    width: \"32px\",\n    // layout\n    display: \"flex\",\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    // look\n    padding: \"0\",\n    margin: \"0\",\n    border: \"none\",\n    cursor: \"pointer\",\n  } as Partial<CSSStyleDeclaration>);\n  element.addEventListener(\"click\", onClick);\n  return { element };\n}\n\nfunction createContainer() {\n  const element = document.createElement(\"div\");\n  Object.assign(element.style, {\n    position: \"fixed\",\n    bottom: \"24px\",\n    right: \"24px\",\n    left: \"60px\",\n    top: \"72px\",\n    display: \"block\",\n    borderRadius: \"4px\",\n    border: \"1px #ccc solid\",\n    boxShadow: \"0px 0px 8px #00000044\",\n    backgroundColor: \"#eee\",\n    zIndex: \"999990\",\n  } as Partial<CSSStyleDeclaration>);\n  element.style.display = \"none\";\n  function isVisible() {\n    return element.style.display !== \"none\";\n  }\n  return { element, isVisible };\n}\n"]}