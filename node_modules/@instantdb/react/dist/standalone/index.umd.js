(function(de,te){typeof exports=="object"&&typeof module<"u"?te(exports,require("react")):typeof define=="function"&&define.amd?define(["exports","react"],te):(de=typeof globalThis<"u"?globalThis:de||self,te(de.instantReact={},de.React))})(this,function(de,te){"use strict";const Ye=(()=>{let t=!1;typeof window<"u"&&typeof window.localStorage<"u"?t=!!window.localStorage.getItem("loggingEnabled"):t=!1;function e(n){return(...r)=>{t&&console[n](...r)}}return{info:e("info"),debug:e("debug"),error:e("error")}})();function st(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Zt={exports:{}};(function(t,e){(function(n){t.exports=n()})(function(){return function n(r,i,o){function s(l,d){if(!i[l]){if(!r[l]){var _=typeof st=="function"&&st;if(!d&&_)return _(l,!0);if(a)return a(l,!0);throw new Error("Cannot find module '"+l+"'")}d=i[l]={exports:{}},r[l][0].call(d.exports,function(P){var D=r[l][1][P];return s(D||P)},d,d.exports,n,r,i,o)}return i[l].exports}for(var a=typeof st=="function"&&st,c=0;c<o.length;c++)s(o[c]);return s}({1:[function(n,r,i){(function(o,s,a,c,l,d,_,P,D){var O=n("crypto");function x(g,S){S=R(g,S);var h;return(h=S.algorithm!=="passthrough"?O.createHash(S.algorithm):new U).write===void 0&&(h.write=h.update,h.end=h.update),M(S,h).dispatch(g),h.update||h.end(""),h.digest?h.digest(S.encoding==="buffer"?void 0:S.encoding):(g=h.read(),S.encoding!=="buffer"?g.toString(S.encoding):g)}(i=r.exports=x).sha1=function(g){return x(g)},i.keys=function(g){return x(g,{excludeValues:!0,algorithm:"sha1",encoding:"hex"})},i.MD5=function(g){return x(g,{algorithm:"md5",encoding:"hex"})},i.keysMD5=function(g){return x(g,{algorithm:"md5",encoding:"hex",excludeValues:!0})};var w=O.getHashes?O.getHashes().slice():["sha1","md5"],A=(w.push("passthrough"),["buffer","hex","binary","base64"]);function R(g,S){var h={};if(h.algorithm=(S=S||{}).algorithm||"sha1",h.encoding=S.encoding||"hex",h.excludeValues=!!S.excludeValues,h.algorithm=h.algorithm.toLowerCase(),h.encoding=h.encoding.toLowerCase(),h.ignoreUnknown=S.ignoreUnknown===!0,h.respectType=S.respectType!==!1,h.respectFunctionNames=S.respectFunctionNames!==!1,h.respectFunctionProperties=S.respectFunctionProperties!==!1,h.unorderedArrays=S.unorderedArrays===!0,h.unorderedSets=S.unorderedSets!==!1,h.unorderedObjects=S.unorderedObjects!==!1,h.replacer=S.replacer||void 0,h.excludeKeys=S.excludeKeys||void 0,g===void 0)throw new Error("Object argument required.");for(var v=0;v<w.length;++v)w[v].toLowerCase()===h.algorithm.toLowerCase()&&(h.algorithm=w[v]);if(w.indexOf(h.algorithm)===-1)throw new Error('Algorithm "'+h.algorithm+'"  not supported. supported values: '+w.join(", "));if(A.indexOf(h.encoding)===-1&&h.algorithm!=="passthrough")throw new Error('Encoding "'+h.encoding+'"  not supported. supported values: '+A.join(", "));return h}function j(g){if(typeof g=="function")return/^function\s+\w*\s*\(\s*\)\s*{\s+\[native code\]\s+}$/i.exec(Function.prototype.toString.call(g))!=null}function M(g,S,h){h=h||[];function v(f){return S.update?S.update(f,"utf8"):S.write(f,"utf8")}return{dispatch:function(f){return this["_"+((f=g.replacer?g.replacer(f):f)===null?"null":typeof f)](f)},_object:function(f){var m,E=Object.prototype.toString.call(f),z=/\[object (.*)\]/i.exec(E);if(z=(z=z?z[1]:"unknown:["+E+"]").toLowerCase(),0<=(E=h.indexOf(f)))return this.dispatch("[CIRCULAR:"+E+"]");if(h.push(f),a!==void 0&&a.isBuffer&&a.isBuffer(f))return v("buffer:"),v(f);if(z==="object"||z==="function"||z==="asyncfunction")return E=Object.keys(f),g.unorderedObjects&&(E=E.sort()),g.respectType===!1||j(f)||E.splice(0,0,"prototype","__proto__","constructor"),g.excludeKeys&&(E=E.filter(function(F){return!g.excludeKeys(F)})),v("object:"+E.length+":"),m=this,E.forEach(function(F){m.dispatch(F),v(":"),g.excludeValues||m.dispatch(f[F]),v(",")});if(!this["_"+z]){if(g.ignoreUnknown)return v("["+z+"]");throw new Error('Unknown object type "'+z+'"')}this["_"+z](f)},_array:function(f,F){F=F!==void 0?F:g.unorderedArrays!==!1;var E=this;if(v("array:"+f.length+":"),!F||f.length<=1)return f.forEach(function(q){return E.dispatch(q)});var z=[],F=f.map(function(q){var k=new U,Y=h.slice();return M(g,k,Y).dispatch(q),z=z.concat(Y.slice(h.length)),k.read().toString()});return h=h.concat(z),F.sort(),this._array(F,!1)},_date:function(f){return v("date:"+f.toJSON())},_symbol:function(f){return v("symbol:"+f.toString())},_error:function(f){return v("error:"+f.toString())},_boolean:function(f){return v("bool:"+f.toString())},_string:function(f){v("string:"+f.length+":"),v(f.toString())},_function:function(f){v("fn:"),j(f)?this.dispatch("[native]"):this.dispatch(f.toString()),g.respectFunctionNames!==!1&&this.dispatch("function-name:"+String(f.name)),g.respectFunctionProperties&&this._object(f)},_number:function(f){return v("number:"+f.toString())},_xml:function(f){return v("xml:"+f.toString())},_null:function(){return v("Null")},_undefined:function(){return v("Undefined")},_regexp:function(f){return v("regex:"+f.toString())},_uint8array:function(f){return v("uint8array:"),this.dispatch(Array.prototype.slice.call(f))},_uint8clampedarray:function(f){return v("uint8clampedarray:"),this.dispatch(Array.prototype.slice.call(f))},_int8array:function(f){return v("int8array:"),this.dispatch(Array.prototype.slice.call(f))},_uint16array:function(f){return v("uint16array:"),this.dispatch(Array.prototype.slice.call(f))},_int16array:function(f){return v("int16array:"),this.dispatch(Array.prototype.slice.call(f))},_uint32array:function(f){return v("uint32array:"),this.dispatch(Array.prototype.slice.call(f))},_int32array:function(f){return v("int32array:"),this.dispatch(Array.prototype.slice.call(f))},_float32array:function(f){return v("float32array:"),this.dispatch(Array.prototype.slice.call(f))},_float64array:function(f){return v("float64array:"),this.dispatch(Array.prototype.slice.call(f))},_arraybuffer:function(f){return v("arraybuffer:"),this.dispatch(new Uint8Array(f))},_url:function(f){return v("url:"+f.toString())},_map:function(f){return v("map:"),f=Array.from(f),this._array(f,g.unorderedSets!==!1)},_set:function(f){return v("set:"),f=Array.from(f),this._array(f,g.unorderedSets!==!1)},_file:function(f){return v("file:"),this.dispatch([f.name,f.size,f.type,f.lastModfied])},_blob:function(){if(g.ignoreUnknown)return v("[blob]");throw Error(`Hashing Blob objects is currently not supported
(see https://github.com/puleos/object-hash/issues/26)
Use "options.replacer" or "options.ignoreUnknown"
`)},_domwindow:function(){return v("domwindow")},_bigint:function(f){return v("bigint:"+f.toString())},_process:function(){return v("process")},_timer:function(){return v("timer")},_pipe:function(){return v("pipe")},_tcp:function(){return v("tcp")},_udp:function(){return v("udp")},_tty:function(){return v("tty")},_statwatcher:function(){return v("statwatcher")},_securecontext:function(){return v("securecontext")},_connection:function(){return v("connection")},_zlib:function(){return v("zlib")},_context:function(){return v("context")},_nodescript:function(){return v("nodescript")},_httpparser:function(){return v("httpparser")},_dataview:function(){return v("dataview")},_signal:function(){return v("signal")},_fsevent:function(){return v("fsevent")},_tlswrap:function(){return v("tlswrap")}}}function U(){return{buf:"",write:function(g){this.buf+=g},end:function(g){this.buf+=g},read:function(){return this.buf}}}i.writeToStream=function(g,S,h){return h===void 0&&(h=S,S={}),M(S=R(g,S),h).dispatch(g)}}).call(this,n("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},n("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/fake_9a5aa49d.js","/")},{buffer:3,crypto:5,lYpoI2:11}],2:[function(n,r,i){(function(o,s,a,c,l,d,_,P,D){(function(O){var x=typeof Uint8Array<"u"?Uint8Array:Array,w=43,A=47,R=48,j=97,M=65,U=45,g=95;function S(h){return h=h.charCodeAt(0),h===w||h===U?62:h===A||h===g?63:h<R?-1:h<R+10?h-R+26+26:h<M+26?h-M:h<j+26?h-j+26:void 0}O.toByteArray=function(h){var v,f;if(0<h.length%4)throw new Error("Invalid string. Length must be a multiple of 4");var m=h.length,m=h.charAt(m-2)==="="?2:h.charAt(m-1)==="="?1:0,E=new x(3*h.length/4-m),z=0<m?h.length-4:h.length,F=0;function q(k){E[F++]=k}for(v=0;v<z;v+=4,0)q((16711680&(f=S(h.charAt(v))<<18|S(h.charAt(v+1))<<12|S(h.charAt(v+2))<<6|S(h.charAt(v+3))))>>16),q((65280&f)>>8),q(255&f);return m==2?q(255&(f=S(h.charAt(v))<<2|S(h.charAt(v+1))>>4)):m==1&&(q((f=S(h.charAt(v))<<10|S(h.charAt(v+1))<<4|S(h.charAt(v+2))>>2)>>8&255),q(255&f)),E},O.fromByteArray=function(h){var v,f,m,E,z=h.length%3,F="";function q(k){return"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(k)}for(v=0,m=h.length-z;v<m;v+=3)f=(h[v]<<16)+(h[v+1]<<8)+h[v+2],F+=q((E=f)>>18&63)+q(E>>12&63)+q(E>>6&63)+q(63&E);switch(z){case 1:F=(F+=q((f=h[h.length-1])>>2))+q(f<<4&63)+"==";break;case 2:F=(F=(F+=q((f=(h[h.length-2]<<8)+h[h.length-1])>>10))+q(f>>4&63))+q(f<<2&63)+"="}return F}})(i===void 0?this.base64js={}:i)}).call(this,n("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},n("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/base64-js/lib/b64.js","/node_modules/gulp-browserify/node_modules/base64-js/lib")},{buffer:3,lYpoI2:11}],3:[function(n,r,i){(function(o,s,w,c,l,d,_,P,D){var O=n("base64-js"),x=n("ieee754");function w(u,p,b){if(!(this instanceof w))return new w(u,p,b);var T,I,B,W,X=typeof u;if(p==="base64"&&X=="string")for(u=(W=u).trim?W.trim():W.replace(/^\s+|\s+$/g,"");u.length%4!=0;)u+="=";if(X=="number")T=ee(u);else if(X=="string")T=w.byteLength(u,p);else{if(X!="object")throw new Error("First argument needs to be a number, array or string.");T=ee(u.length)}if(w._useTypedArrays?I=w._augment(new Uint8Array(T)):((I=this).length=T,I._isBuffer=!0),w._useTypedArrays&&typeof u.byteLength=="number")I._set(u);else if(H(W=u)||w.isBuffer(W)||W&&typeof W=="object"&&typeof W.length=="number")for(B=0;B<T;B++)w.isBuffer(u)?I[B]=u.readUInt8(B):I[B]=u[B];else if(X=="string")I.write(u,0,p);else if(X=="number"&&!w._useTypedArrays&&!b)for(B=0;B<T;B++)I[B]=0;return I}function A(u,p,b,T){return w._charsWritten=Le(function(I){for(var B=[],W=0;W<I.length;W++)B.push(255&I.charCodeAt(W));return B}(p),u,b,T)}function R(u,p,b,T){return w._charsWritten=Le(function(I){for(var B,W,X=[],ne=0;ne<I.length;ne++)W=I.charCodeAt(ne),B=W>>8,W=W%256,X.push(W),X.push(B);return X}(p),u,b,T)}function j(u,p,b){var T="";b=Math.min(u.length,b);for(var I=p;I<b;I++)T+=String.fromCharCode(u[I]);return T}function M(u,p,b,B){B||(L(typeof b=="boolean","missing or invalid endian"),L(p!=null,"missing offset"),L(p+1<u.length,"Trying to read beyond buffer length"));var I,B=u.length;if(!(B<=p))return b?(I=u[p],p+1<B&&(I|=u[p+1]<<8)):(I=u[p]<<8,p+1<B&&(I|=u[p+1])),I}function U(u,p,b,B){B||(L(typeof b=="boolean","missing or invalid endian"),L(p!=null,"missing offset"),L(p+3<u.length,"Trying to read beyond buffer length"));var I,B=u.length;if(!(B<=p))return b?(p+2<B&&(I=u[p+2]<<16),p+1<B&&(I|=u[p+1]<<8),I|=u[p],p+3<B&&(I+=u[p+3]<<24>>>0)):(p+1<B&&(I=u[p+1]<<16),p+2<B&&(I|=u[p+2]<<8),p+3<B&&(I|=u[p+3]),I+=u[p]<<24>>>0),I}function g(u,p,b,T){if(T||(L(typeof b=="boolean","missing or invalid endian"),L(p!=null,"missing offset"),L(p+1<u.length,"Trying to read beyond buffer length")),!(u.length<=p))return T=M(u,p,b,!0),32768&T?-1*(65535-T+1):T}function S(u,p,b,T){if(T||(L(typeof b=="boolean","missing or invalid endian"),L(p!=null,"missing offset"),L(p+3<u.length,"Trying to read beyond buffer length")),!(u.length<=p))return T=U(u,p,b,!0),2147483648&T?-1*(4294967295-T+1):T}function h(u,p,b,T){return T||(L(typeof b=="boolean","missing or invalid endian"),L(p+3<u.length,"Trying to read beyond buffer length")),x.read(u,p,b,23,4)}function v(u,p,b,T){return T||(L(typeof b=="boolean","missing or invalid endian"),L(p+7<u.length,"Trying to read beyond buffer length")),x.read(u,p,b,52,8)}function f(u,p,b,T,I){if(I||(L(p!=null,"missing value"),L(typeof T=="boolean","missing or invalid endian"),L(b!=null,"missing offset"),L(b+1<u.length,"trying to write beyond buffer length"),We(p,65535)),I=u.length,!(I<=b))for(var B=0,W=Math.min(I-b,2);B<W;B++)u[b+B]=(p&255<<8*(T?B:1-B))>>>8*(T?B:1-B)}function m(u,p,b,T,I){if(I||(L(p!=null,"missing value"),L(typeof T=="boolean","missing or invalid endian"),L(b!=null,"missing offset"),L(b+3<u.length,"trying to write beyond buffer length"),We(p,4294967295)),I=u.length,!(I<=b))for(var B=0,W=Math.min(I-b,4);B<W;B++)u[b+B]=p>>>8*(T?B:3-B)&255}function E(u,p,b,T,I){I||(L(p!=null,"missing value"),L(typeof T=="boolean","missing or invalid endian"),L(b!=null,"missing offset"),L(b+1<u.length,"Trying to write beyond buffer length"),$e(p,32767,-32768)),u.length<=b||f(u,0<=p?p:65535+p+1,b,T,I)}function z(u,p,b,T,I){I||(L(p!=null,"missing value"),L(typeof T=="boolean","missing or invalid endian"),L(b!=null,"missing offset"),L(b+3<u.length,"Trying to write beyond buffer length"),$e(p,2147483647,-2147483648)),u.length<=b||m(u,0<=p?p:4294967295+p+1,b,T,I)}function F(u,p,b,T,I){I||(L(p!=null,"missing value"),L(typeof T=="boolean","missing or invalid endian"),L(b!=null,"missing offset"),L(b+3<u.length,"Trying to write beyond buffer length"),Be(p,34028234663852886e22,-34028234663852886e22)),u.length<=b||x.write(u,p,b,T,23,4)}function q(u,p,b,T,I){I||(L(p!=null,"missing value"),L(typeof T=="boolean","missing or invalid endian"),L(b!=null,"missing offset"),L(b+7<u.length,"Trying to write beyond buffer length"),Be(p,17976931348623157e292,-17976931348623157e292)),u.length<=b||x.write(u,p,b,T,52,8)}i.Buffer=w,i.SlowBuffer=w,i.INSPECT_MAX_BYTES=50,w.poolSize=8192,w._useTypedArrays=function(){try{var u=new ArrayBuffer(0),p=new Uint8Array(u);return p.foo=function(){return 42},p.foo()===42&&typeof p.subarray=="function"}catch{return!1}}(),w.isEncoding=function(u){switch(String(u).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"raw":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},w.isBuffer=function(u){return!(u==null||!u._isBuffer)},w.byteLength=function(u,p){var b;switch(u+="",p||"utf8"){case"hex":b=u.length/2;break;case"utf8":case"utf-8":b=be(u).length;break;case"ascii":case"binary":case"raw":b=u.length;break;case"base64":b=Ee(u).length;break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":b=2*u.length;break;default:throw new Error("Unknown encoding")}return b},w.concat=function(u,p){if(L(H(u),`Usage: Buffer.concat(list, [totalLength])
list should be an Array.`),u.length===0)return new w(0);if(u.length===1)return u[0];if(typeof p!="number")for(I=p=0;I<u.length;I++)p+=u[I].length;for(var b=new w(p),T=0,I=0;I<u.length;I++){var B=u[I];B.copy(b,T),T+=B.length}return b},w.prototype.write=function(u,p,b,T){isFinite(p)?isFinite(b)||(T=b,b=void 0):(ne=T,T=p,p=b,b=ne),p=Number(p)||0;var I,B,W,X,ne=this.length-p;switch((!b||ne<(b=Number(b)))&&(b=ne),T=String(T||"utf8").toLowerCase()){case"hex":I=function(ge,fe,ue,se){ue=Number(ue)||0;var re=ge.length-ue;(!se||re<(se=Number(se)))&&(se=re),L((re=fe.length)%2==0,"Invalid hex string"),re/2<se&&(se=re/2);for(var Ce=0;Ce<se;Ce++){var wt=parseInt(fe.substr(2*Ce,2),16);L(!isNaN(wt),"Invalid hex string"),ge[ue+Ce]=wt}return w._charsWritten=2*Ce,Ce}(this,u,p,b);break;case"utf8":case"utf-8":B=this,W=p,X=b,I=w._charsWritten=Le(be(u),B,W,X);break;case"ascii":case"binary":I=A(this,u,p,b);break;case"base64":B=this,W=p,X=b,I=w._charsWritten=Le(Ee(u),B,W,X);break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":I=R(this,u,p,b);break;default:throw new Error("Unknown encoding")}return I},w.prototype.toString=function(u,p,b){var T,I,B,W,X=this;if(u=String(u||"utf8").toLowerCase(),p=Number(p)||0,(b=b!==void 0?Number(b):X.length)===p)return"";switch(u){case"hex":T=function(ne,ge,fe){var ue=ne.length;(!ge||ge<0)&&(ge=0),(!fe||fe<0||ue<fe)&&(fe=ue);for(var se="",re=ge;re<fe;re++)se+=Q(ne[re]);return se}(X,p,b);break;case"utf8":case"utf-8":T=function(ne,ge,fe){var ue="",se="";fe=Math.min(ne.length,fe);for(var re=ge;re<fe;re++)ne[re]<=127?(ue+=Ve(se)+String.fromCharCode(ne[re]),se=""):se+="%"+ne[re].toString(16);return ue+Ve(se)}(X,p,b);break;case"ascii":case"binary":T=j(X,p,b);break;case"base64":I=X,W=b,T=(B=p)===0&&W===I.length?O.fromByteArray(I):O.fromByteArray(I.slice(B,W));break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":T=function(ne,ge,fe){for(var ue=ne.slice(ge,fe),se="",re=0;re<ue.length;re+=2)se+=String.fromCharCode(ue[re]+256*ue[re+1]);return se}(X,p,b);break;default:throw new Error("Unknown encoding")}return T},w.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},w.prototype.copy=function(u,p,b,T){if(p=p||0,(T=T||T===0?T:this.length)!==(b=b||0)&&u.length!==0&&this.length!==0){L(b<=T,"sourceEnd < sourceStart"),L(0<=p&&p<u.length,"targetStart out of bounds"),L(0<=b&&b<this.length,"sourceStart out of bounds"),L(0<=T&&T<=this.length,"sourceEnd out of bounds"),T>this.length&&(T=this.length);var I=(T=u.length-p<T-b?u.length-p+b:T)-b;if(I<100||!w._useTypedArrays)for(var B=0;B<I;B++)u[B+p]=this[B+b];else u._set(this.subarray(b,b+I),p)}},w.prototype.slice=function(u,p){var b=this.length;if(u=Y(u,b,0),p=Y(p,b,b),w._useTypedArrays)return w._augment(this.subarray(u,p));for(var T=p-u,I=new w(T,void 0,!0),B=0;B<T;B++)I[B]=this[B+u];return I},w.prototype.get=function(u){return console.log(".get() is deprecated. Access using array indexes instead."),this.readUInt8(u)},w.prototype.set=function(u,p){return console.log(".set() is deprecated. Access using array indexes instead."),this.writeUInt8(u,p)},w.prototype.readUInt8=function(u,p){if(p||(L(u!=null,"missing offset"),L(u<this.length,"Trying to read beyond buffer length")),!(u>=this.length))return this[u]},w.prototype.readUInt16LE=function(u,p){return M(this,u,!0,p)},w.prototype.readUInt16BE=function(u,p){return M(this,u,!1,p)},w.prototype.readUInt32LE=function(u,p){return U(this,u,!0,p)},w.prototype.readUInt32BE=function(u,p){return U(this,u,!1,p)},w.prototype.readInt8=function(u,p){if(p||(L(u!=null,"missing offset"),L(u<this.length,"Trying to read beyond buffer length")),!(u>=this.length))return 128&this[u]?-1*(255-this[u]+1):this[u]},w.prototype.readInt16LE=function(u,p){return g(this,u,!0,p)},w.prototype.readInt16BE=function(u,p){return g(this,u,!1,p)},w.prototype.readInt32LE=function(u,p){return S(this,u,!0,p)},w.prototype.readInt32BE=function(u,p){return S(this,u,!1,p)},w.prototype.readFloatLE=function(u,p){return h(this,u,!0,p)},w.prototype.readFloatBE=function(u,p){return h(this,u,!1,p)},w.prototype.readDoubleLE=function(u,p){return v(this,u,!0,p)},w.prototype.readDoubleBE=function(u,p){return v(this,u,!1,p)},w.prototype.writeUInt8=function(u,p,b){b||(L(u!=null,"missing value"),L(p!=null,"missing offset"),L(p<this.length,"trying to write beyond buffer length"),We(u,255)),p>=this.length||(this[p]=u)},w.prototype.writeUInt16LE=function(u,p,b){f(this,u,p,!0,b)},w.prototype.writeUInt16BE=function(u,p,b){f(this,u,p,!1,b)},w.prototype.writeUInt32LE=function(u,p,b){m(this,u,p,!0,b)},w.prototype.writeUInt32BE=function(u,p,b){m(this,u,p,!1,b)},w.prototype.writeInt8=function(u,p,b){b||(L(u!=null,"missing value"),L(p!=null,"missing offset"),L(p<this.length,"Trying to write beyond buffer length"),$e(u,127,-128)),p>=this.length||(0<=u?this.writeUInt8(u,p,b):this.writeUInt8(255+u+1,p,b))},w.prototype.writeInt16LE=function(u,p,b){E(this,u,p,!0,b)},w.prototype.writeInt16BE=function(u,p,b){E(this,u,p,!1,b)},w.prototype.writeInt32LE=function(u,p,b){z(this,u,p,!0,b)},w.prototype.writeInt32BE=function(u,p,b){z(this,u,p,!1,b)},w.prototype.writeFloatLE=function(u,p,b){F(this,u,p,!0,b)},w.prototype.writeFloatBE=function(u,p,b){F(this,u,p,!1,b)},w.prototype.writeDoubleLE=function(u,p,b){q(this,u,p,!0,b)},w.prototype.writeDoubleBE=function(u,p,b){q(this,u,p,!1,b)},w.prototype.fill=function(u,p,b){if(p=p||0,b=b||this.length,L(typeof(u=typeof(u=u||0)=="string"?u.charCodeAt(0):u)=="number"&&!isNaN(u),"value is not a number"),L(p<=b,"end < start"),b!==p&&this.length!==0){L(0<=p&&p<this.length,"start out of bounds"),L(0<=b&&b<=this.length,"end out of bounds");for(var T=p;T<b;T++)this[T]=u}},w.prototype.inspect=function(){for(var u=[],p=this.length,b=0;b<p;b++)if(u[b]=Q(this[b]),b===i.INSPECT_MAX_BYTES){u[b+1]="...";break}return"<Buffer "+u.join(" ")+">"},w.prototype.toArrayBuffer=function(){if(typeof Uint8Array>"u")throw new Error("Buffer.toArrayBuffer not supported in this browser");if(w._useTypedArrays)return new w(this).buffer;for(var u=new Uint8Array(this.length),p=0,b=u.length;p<b;p+=1)u[p]=this[p];return u.buffer};var k=w.prototype;function Y(u,p,b){return typeof u!="number"?b:p<=(u=~~u)?p:0<=u||0<=(u+=p)?u:0}function ee(u){return(u=~~Math.ceil(+u))<0?0:u}function H(u){return(Array.isArray||function(p){return Object.prototype.toString.call(p)==="[object Array]"})(u)}function Q(u){return u<16?"0"+u.toString(16):u.toString(16)}function be(u){for(var p=[],b=0;b<u.length;b++){var T=u.charCodeAt(b);if(T<=127)p.push(u.charCodeAt(b));else for(var I=b,B=(55296<=T&&T<=57343&&b++,encodeURIComponent(u.slice(I,b+1)).substr(1).split("%")),W=0;W<B.length;W++)p.push(parseInt(B[W],16))}return p}function Ee(u){return O.toByteArray(u)}function Le(u,p,b,T){for(var I=0;I<T&&!(I+b>=p.length||I>=u.length);I++)p[I+b]=u[I];return I}function Ve(u){try{return decodeURIComponent(u)}catch{return"ï¿½"}}function We(u,p){L(typeof u=="number","cannot write a non-number as a number"),L(0<=u,"specified a negative value for writing an unsigned value"),L(u<=p,"value is larger than maximum value for type"),L(Math.floor(u)===u,"value has a fractional component")}function $e(u,p,b){L(typeof u=="number","cannot write a non-number as a number"),L(u<=p,"value larger than maximum allowed value"),L(b<=u,"value smaller than minimum allowed value"),L(Math.floor(u)===u,"value has a fractional component")}function Be(u,p,b){L(typeof u=="number","cannot write a non-number as a number"),L(u<=p,"value larger than maximum allowed value"),L(b<=u,"value smaller than minimum allowed value")}function L(u,p){if(!u)throw new Error(p||"Failed assertion")}w._augment=function(u){return u._isBuffer=!0,u._get=u.get,u._set=u.set,u.get=k.get,u.set=k.set,u.write=k.write,u.toString=k.toString,u.toLocaleString=k.toString,u.toJSON=k.toJSON,u.copy=k.copy,u.slice=k.slice,u.readUInt8=k.readUInt8,u.readUInt16LE=k.readUInt16LE,u.readUInt16BE=k.readUInt16BE,u.readUInt32LE=k.readUInt32LE,u.readUInt32BE=k.readUInt32BE,u.readInt8=k.readInt8,u.readInt16LE=k.readInt16LE,u.readInt16BE=k.readInt16BE,u.readInt32LE=k.readInt32LE,u.readInt32BE=k.readInt32BE,u.readFloatLE=k.readFloatLE,u.readFloatBE=k.readFloatBE,u.readDoubleLE=k.readDoubleLE,u.readDoubleBE=k.readDoubleBE,u.writeUInt8=k.writeUInt8,u.writeUInt16LE=k.writeUInt16LE,u.writeUInt16BE=k.writeUInt16BE,u.writeUInt32LE=k.writeUInt32LE,u.writeUInt32BE=k.writeUInt32BE,u.writeInt8=k.writeInt8,u.writeInt16LE=k.writeInt16LE,u.writeInt16BE=k.writeInt16BE,u.writeInt32LE=k.writeInt32LE,u.writeInt32BE=k.writeInt32BE,u.writeFloatLE=k.writeFloatLE,u.writeFloatBE=k.writeFloatBE,u.writeDoubleLE=k.writeDoubleLE,u.writeDoubleBE=k.writeDoubleBE,u.fill=k.fill,u.inspect=k.inspect,u.toArrayBuffer=k.toArrayBuffer,u}}).call(this,n("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},n("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/buffer/index.js","/node_modules/gulp-browserify/node_modules/buffer")},{"base64-js":2,buffer:3,ieee754:10,lYpoI2:11}],4:[function(n,r,i){(function(o,s,O,c,l,d,_,P,D){var O=n("buffer").Buffer,x=4,w=new O(x);w.fill(0),r.exports={hash:function(A,R,j,M){for(var U=R(function(f,m){f.length%x!=0&&(E=f.length+(x-f.length%x),f=O.concat([f,w],E));for(var E,z=[],F=m?f.readInt32BE:f.readInt32LE,q=0;q<f.length;q+=x)z.push(F.call(f,q));return z}(A=O.isBuffer(A)?A:new O(A),M),8*A.length),R=M,g=new O(j),S=R?g.writeInt32BE:g.writeInt32LE,h=0;h<U.length;h++)S.call(g,U[h],4*h,!0);return g}}}).call(this,n("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},n("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/helpers.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{buffer:3,lYpoI2:11}],5:[function(n,r,i){(function(o,s,O,c,l,d,_,P,D){var O=n("buffer").Buffer,x=n("./sha"),w=n("./sha256"),A=n("./rng"),R={sha1:x,sha256:w,md5:n("./md5")},j=64,M=new O(j);function U(f,m){var E=R[f=f||"sha1"],z=[];return E||g("algorithm:",f,"is not yet supported"),{update:function(F){return O.isBuffer(F)||(F=new O(F)),z.push(F),F.length,this},digest:function(F){var q=O.concat(z),q=m?function(k,Y,ee){O.isBuffer(Y)||(Y=new O(Y)),O.isBuffer(ee)||(ee=new O(ee)),Y.length>j?Y=k(Y):Y.length<j&&(Y=O.concat([Y,M],j));for(var H=new O(j),Q=new O(j),be=0;be<j;be++)H[be]=54^Y[be],Q[be]=92^Y[be];return ee=k(O.concat([H,ee])),k(O.concat([Q,ee]))}(E,m,q):E(q);return z=null,F?q.toString(F):q}}}function g(){var f=[].slice.call(arguments).join(" ");throw new Error([f,"we accept pull requests","http://github.com/dominictarr/crypto-browserify"].join(`
`))}M.fill(0),i.createHash=function(f){return U(f)},i.createHmac=U,i.randomBytes=function(f,m){if(!m||!m.call)return new O(A(f));try{m.call(this,void 0,new O(A(f)))}catch(E){m(E)}};var S,h=["createCredentials","createCipher","createCipheriv","createDecipher","createDecipheriv","createSign","createVerify","createDiffieHellman","pbkdf2"],v=function(f){i[f]=function(){g("sorry,",f,"is not implemented yet")}};for(S in h)v(h[S])}).call(this,n("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},n("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/index.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./md5":6,"./rng":7,"./sha":8,"./sha256":9,buffer:3,lYpoI2:11}],6:[function(n,r,i){(function(o,s,a,c,l,d,_,P,D){var O=n("./helpers");function x(g,S){g[S>>5]|=128<<S%32,g[14+(S+64>>>9<<4)]=S;for(var h=1732584193,v=-271733879,f=-1732584194,m=271733878,E=0;E<g.length;E+=16){var z=h,F=v,q=f,k=m,h=A(h,v,f,m,g[E+0],7,-680876936),m=A(m,h,v,f,g[E+1],12,-389564586),f=A(f,m,h,v,g[E+2],17,606105819),v=A(v,f,m,h,g[E+3],22,-1044525330);h=A(h,v,f,m,g[E+4],7,-176418897),m=A(m,h,v,f,g[E+5],12,1200080426),f=A(f,m,h,v,g[E+6],17,-1473231341),v=A(v,f,m,h,g[E+7],22,-45705983),h=A(h,v,f,m,g[E+8],7,1770035416),m=A(m,h,v,f,g[E+9],12,-1958414417),f=A(f,m,h,v,g[E+10],17,-42063),v=A(v,f,m,h,g[E+11],22,-1990404162),h=A(h,v,f,m,g[E+12],7,1804603682),m=A(m,h,v,f,g[E+13],12,-40341101),f=A(f,m,h,v,g[E+14],17,-1502002290),h=R(h,v=A(v,f,m,h,g[E+15],22,1236535329),f,m,g[E+1],5,-165796510),m=R(m,h,v,f,g[E+6],9,-1069501632),f=R(f,m,h,v,g[E+11],14,643717713),v=R(v,f,m,h,g[E+0],20,-373897302),h=R(h,v,f,m,g[E+5],5,-701558691),m=R(m,h,v,f,g[E+10],9,38016083),f=R(f,m,h,v,g[E+15],14,-660478335),v=R(v,f,m,h,g[E+4],20,-405537848),h=R(h,v,f,m,g[E+9],5,568446438),m=R(m,h,v,f,g[E+14],9,-1019803690),f=R(f,m,h,v,g[E+3],14,-187363961),v=R(v,f,m,h,g[E+8],20,1163531501),h=R(h,v,f,m,g[E+13],5,-1444681467),m=R(m,h,v,f,g[E+2],9,-51403784),f=R(f,m,h,v,g[E+7],14,1735328473),h=j(h,v=R(v,f,m,h,g[E+12],20,-1926607734),f,m,g[E+5],4,-378558),m=j(m,h,v,f,g[E+8],11,-2022574463),f=j(f,m,h,v,g[E+11],16,1839030562),v=j(v,f,m,h,g[E+14],23,-35309556),h=j(h,v,f,m,g[E+1],4,-1530992060),m=j(m,h,v,f,g[E+4],11,1272893353),f=j(f,m,h,v,g[E+7],16,-155497632),v=j(v,f,m,h,g[E+10],23,-1094730640),h=j(h,v,f,m,g[E+13],4,681279174),m=j(m,h,v,f,g[E+0],11,-358537222),f=j(f,m,h,v,g[E+3],16,-722521979),v=j(v,f,m,h,g[E+6],23,76029189),h=j(h,v,f,m,g[E+9],4,-640364487),m=j(m,h,v,f,g[E+12],11,-421815835),f=j(f,m,h,v,g[E+15],16,530742520),h=M(h,v=j(v,f,m,h,g[E+2],23,-995338651),f,m,g[E+0],6,-198630844),m=M(m,h,v,f,g[E+7],10,1126891415),f=M(f,m,h,v,g[E+14],15,-1416354905),v=M(v,f,m,h,g[E+5],21,-57434055),h=M(h,v,f,m,g[E+12],6,1700485571),m=M(m,h,v,f,g[E+3],10,-1894986606),f=M(f,m,h,v,g[E+10],15,-1051523),v=M(v,f,m,h,g[E+1],21,-2054922799),h=M(h,v,f,m,g[E+8],6,1873313359),m=M(m,h,v,f,g[E+15],10,-30611744),f=M(f,m,h,v,g[E+6],15,-1560198380),v=M(v,f,m,h,g[E+13],21,1309151649),h=M(h,v,f,m,g[E+4],6,-145523070),m=M(m,h,v,f,g[E+11],10,-1120210379),f=M(f,m,h,v,g[E+2],15,718787259),v=M(v,f,m,h,g[E+9],21,-343485551),h=U(h,z),v=U(v,F),f=U(f,q),m=U(m,k)}return Array(h,v,f,m)}function w(g,S,h,v,f,m){return U((S=U(U(S,g),U(v,m)))<<f|S>>>32-f,h)}function A(g,S,h,v,f,m,E){return w(S&h|~S&v,g,S,f,m,E)}function R(g,S,h,v,f,m,E){return w(S&v|h&~v,g,S,f,m,E)}function j(g,S,h,v,f,m,E){return w(S^h^v,g,S,f,m,E)}function M(g,S,h,v,f,m,E){return w(h^(S|~v),g,S,f,m,E)}function U(g,S){var h=(65535&g)+(65535&S);return(g>>16)+(S>>16)+(h>>16)<<16|65535&h}r.exports=function(g){return O.hash(g,x,16)}}).call(this,n("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},n("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/md5.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:11}],7:[function(n,r,i){(function(o,s,a,c,l,d,_,P,D){r.exports=function(O){for(var x,w=new Array(O),A=0;A<O;A++)!(3&A)&&(x=4294967296*Math.random()),w[A]=x>>>((3&A)<<3)&255;return w}}).call(this,n("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},n("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/rng.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{buffer:3,lYpoI2:11}],8:[function(n,r,i){(function(o,s,a,c,l,d,_,P,D){var O=n("./helpers");function x(R,j){R[j>>5]|=128<<24-j%32,R[15+(j+64>>9<<4)]=j;for(var M,U,g,S=Array(80),h=1732584193,v=-271733879,f=-1732584194,m=271733878,E=-1009589776,z=0;z<R.length;z+=16){for(var F=h,q=v,k=f,Y=m,ee=E,H=0;H<80;H++){S[H]=H<16?R[z+H]:A(S[H-3]^S[H-8]^S[H-14]^S[H-16],1);var Q=w(w(A(h,5),(Q=v,U=f,g=m,(M=H)<20?Q&U|~Q&g:!(M<40)&&M<60?Q&U|Q&g|U&g:Q^U^g)),w(w(E,S[H]),(M=H)<20?1518500249:M<40?1859775393:M<60?-1894007588:-899497514)),E=m,m=f,f=A(v,30),v=h,h=Q}h=w(h,F),v=w(v,q),f=w(f,k),m=w(m,Y),E=w(E,ee)}return Array(h,v,f,m,E)}function w(R,j){var M=(65535&R)+(65535&j);return(R>>16)+(j>>16)+(M>>16)<<16|65535&M}function A(R,j){return R<<j|R>>>32-j}r.exports=function(R){return O.hash(R,x,20,!0)}}).call(this,n("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},n("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/sha.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:11}],9:[function(n,r,i){(function(o,s,a,c,l,d,_,P,D){function O(j,M){var U=(65535&j)+(65535&M);return(j>>16)+(M>>16)+(U>>16)<<16|65535&U}function x(j,M){var U,g=new Array(1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298),S=new Array(1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225),h=new Array(64);j[M>>5]|=128<<24-M%32,j[15+(M+64>>9<<4)]=M;for(var v,f,m=0;m<j.length;m+=16){for(var E=S[0],z=S[1],F=S[2],q=S[3],k=S[4],Y=S[5],ee=S[6],H=S[7],Q=0;Q<64;Q++)h[Q]=Q<16?j[Q+m]:O(O(O((f=h[Q-2],A(f,17)^A(f,19)^R(f,10)),h[Q-7]),(f=h[Q-15],A(f,7)^A(f,18)^R(f,3))),h[Q-16]),U=O(O(O(O(H,A(f=k,6)^A(f,11)^A(f,25)),k&Y^~k&ee),g[Q]),h[Q]),v=O(A(v=E,2)^A(v,13)^A(v,22),E&z^E&F^z&F),H=ee,ee=Y,Y=k,k=O(q,U),q=F,F=z,z=E,E=O(U,v);S[0]=O(E,S[0]),S[1]=O(z,S[1]),S[2]=O(F,S[2]),S[3]=O(q,S[3]),S[4]=O(k,S[4]),S[5]=O(Y,S[5]),S[6]=O(ee,S[6]),S[7]=O(H,S[7])}return S}var w=n("./helpers"),A=function(j,M){return j>>>M|j<<32-M},R=function(j,M){return j>>>M};r.exports=function(j){return w.hash(j,x,32,!0)}}).call(this,n("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},n("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/sha256.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:11}],10:[function(n,r,i){(function(o,s,a,c,l,d,_,P,D){i.read=function(O,x,w,A,m){var j,M,U=8*m-A-1,g=(1<<U)-1,S=g>>1,h=-7,v=w?m-1:0,f=w?-1:1,m=O[x+v];for(v+=f,j=m&(1<<-h)-1,m>>=-h,h+=U;0<h;j=256*j+O[x+v],v+=f,h-=8);for(M=j&(1<<-h)-1,j>>=-h,h+=A;0<h;M=256*M+O[x+v],v+=f,h-=8);if(j===0)j=1-S;else{if(j===g)return M?NaN:1/0*(m?-1:1);M+=Math.pow(2,A),j-=S}return(m?-1:1)*M*Math.pow(2,j-A)},i.write=function(O,x,w,A,R,E){var M,U,g=8*E-R-1,S=(1<<g)-1,h=S>>1,v=R===23?Math.pow(2,-24)-Math.pow(2,-77):0,f=A?0:E-1,m=A?1:-1,E=x<0||x===0&&1/x<0?1:0;for(x=Math.abs(x),isNaN(x)||x===1/0?(U=isNaN(x)?1:0,M=S):(M=Math.floor(Math.log(x)/Math.LN2),x*(A=Math.pow(2,-M))<1&&(M--,A*=2),2<=(x+=1<=M+h?v/A:v*Math.pow(2,1-h))*A&&(M++,A/=2),S<=M+h?(U=0,M=S):1<=M+h?(U=(x*A-1)*Math.pow(2,R),M+=h):(U=x*Math.pow(2,h-1)*Math.pow(2,R),M=0));8<=R;O[w+f]=255&U,f+=m,U/=256,R-=8);for(M=M<<R|U,g+=R;0<g;O[w+f]=255&M,f+=m,M/=256,g-=8);O[w+f-m]|=128*E}}).call(this,n("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},n("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/ieee754/index.js","/node_modules/gulp-browserify/node_modules/ieee754")},{buffer:3,lYpoI2:11}],11:[function(n,r,i){(function(o,s,a,c,l,d,_,P,D){var O,x,w;function A(){}(o=r.exports={}).nextTick=(x=typeof window<"u"&&window.setImmediate,w=typeof window<"u"&&window.postMessage&&window.addEventListener,x?function(R){return window.setImmediate(R)}:w?(O=[],window.addEventListener("message",function(R){var j=R.source;j!==window&&j!==null||R.data!=="process-tick"||(R.stopPropagation(),0<O.length&&O.shift()())},!0),function(R){O.push(R),window.postMessage("process-tick","*")}):function(R){setTimeout(R,0)}),o.title="browser",o.browser=!0,o.env={},o.argv=[],o.on=A,o.addListener=A,o.once=A,o.off=A,o.removeListener=A,o.removeAllListeners=A,o.emit=A,o.binding=function(R){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(R){throw new Error("process.chdir is not supported")}}).call(this,n("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},n("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/process/browser.js","/node_modules/gulp-browserify/node_modules/process")},{buffer:3,lYpoI2:11}]},{},[1])(1)})})(Zt);var fr=Zt.exports;const Te=fr.MD5,ie={Remove:"remove",Replace:"replace",Add:"add"},en=Symbol.for("__MUTATIVE_PROXY_DRAFT__"),dr=Symbol("__MUTATIVE_RAW_RETURN_SYMBOL__"),at=Symbol.iterator,_e={mutable:"mutable",immutable:"immutable"},Et={};function me(t){var e;return(e=t.copy)!==null&&e!==void 0?e:t.original}function Ne(t){return!!$(t)}function $(t){return typeof t!="object"?null:t==null?void 0:t[en]}function St(t){var e;const n=$(t);return n?(e=n.copy)!==null&&e!==void 0?e:n.original:t}function je(t,e){if(!t||typeof t!="object")return!1;let n;return Object.getPrototypeOf(t)===Object.prototype||Array.isArray(t)||t instanceof Map||t instanceof Set||!!(e!=null&&e.mark)&&((n=e.mark(t,_e))===_e.immutable||typeof n=="function")}function tn(t,e=[]){if(Object.hasOwnProperty.call(t,"key")){const n=$(Me(t.parent.copy,t.key));if(n!==null&&(n==null?void 0:n.original)!==t.original)return null;e.push(t.parent.type===3?Array.from(t.parent.setMap.keys()).indexOf(t.key):t.key)}if(t.parent)return tn(t.parent,e);e.reverse();try{hr(t.copy,e)}catch{return null}return e}function Fe(t){return Array.isArray(t)?1:t instanceof Map?2:t instanceof Set?3:0}function Me(t,e){return Fe(t)===2?t.get(e):t[e]}function Xe(t,e,n){Fe(t)===2?t.set(e,n):t[e]=n}function Ot(t,e){const n=$(t);return(n?me(n):t)[e]}function Pe(t,e){return t===e?t!==0||1/t===1/e:t!==t&&e!==e}function jt(t){if(t)for(;t.finalities.revoke.length>0;)t.finalities.revoke.pop()()}function qe(t,e){return e?t:[""].concat(t).map(n=>{const r=`${n}`;return r.indexOf("/")===-1&&r.indexOf("~")===-1?r:r.replace(/~/g,"~0").replace(/\//g,"~1")}).join("/")}function hr(t,e){for(let n=0;n<e.length-1;n+=1){const r=e[n];if(t=Me(Fe(t)===3?Array.from(t):t,r),typeof t!="object")throw new Error(`Cannot resolve patch at '${e.join("/")}'.`)}return t}function pr(t){const e=Object.create(Object.getPrototypeOf(t));return Reflect.ownKeys(t).forEach(n=>{let r=Reflect.getOwnPropertyDescriptor(t,n);if(r.enumerable&&r.configurable&&r.writable){e[n]=t[n];return}r.writable||(r.writable=!0,r.configurable=!0),(r.get||r.set)&&(r={configurable:!0,writable:!0,enumerable:r.enumerable,value:t[n]}),Reflect.defineProperty(e,n,r)}),e}const yr=Object.prototype.propertyIsEnumerable;function nn(t,e){let n;if(Array.isArray(t))return Array.prototype.concat.call(t);if(t instanceof Set)return new Set(t.values());if(t instanceof Map)return new Map(t);if(e!=null&&e.mark&&(n=e.mark(t,_e),n!==void 0)&&n!==_e.mutable){if(n===_e.immutable)return pr(t);if(typeof n=="function"){if(e.enablePatches||e.enableAutoFreeze)throw new Error("You can't use mark and patches or auto freeze together.");return n()}throw new Error(`Unsupported mark result: ${n}`)}else if(typeof t=="object"&&Object.getPrototypeOf(t)===Object.prototype){const r={};return Object.keys(t).forEach(i=>{r[i]=t[i]}),Object.getOwnPropertySymbols(t).forEach(i=>{yr.call(t,i)&&(r[i]=t[i])}),r}else throw new Error("Please check mark() to ensure that it is a stable marker draftable function.")}function he(t){t.copy||(t.copy=nn(t.original,t.options))}function Ze(t){if(!je(t))return St(t);if(Array.isArray(t))return t.map(Ze);if(t instanceof Map)return new Map(Array.from(t.entries()).map(([n,r])=>[n,Ze(r)]));if(t instanceof Set)return new Set(Array.from(t).map(Ze));const e=Object.create(Object.getPrototypeOf(t));for(const n in t)e[n]=Ze(t[n]);return e}function ut(t){return Ne(t)?Ze(t):t}function xe(t){var e;t.assignedMap=(e=t.assignedMap)!==null&&e!==void 0?e:new Map,t.operated||(t.operated=!0,t.parent&&xe(t.parent))}function rn(){throw new Error("Cannot modify frozen object")}function Je(t,e,n,r,i){{n=n??new WeakMap,r=r??[],i=i??[];const s=n.has(t)?n.get(t):t;if(r.length>0){const a=r.indexOf(s);if(s&&typeof s=="object"&&a!==-1)throw r[0]===s?new Error("Forbids circular reference"):new Error(`Forbids circular reference: ~/${i.slice(0,a).map((c,l)=>{if(typeof c=="symbol")return`[${c.toString()}]`;const d=r[l];return typeof c=="object"&&(d instanceof Map||d instanceof Set)?Array.from(d.keys()).indexOf(c):c}).join("/")}`);r.push(s),i.push(e)}else r.push(s)}if(Object.isFrozen(t)||Ne(t)){r.pop(),i.pop();return}switch(Fe(t)){case 2:for(const[a,c]of t)Je(a,a,n,r,i),Je(c,a,n,r,i);t.set=t.clear=t.delete=rn;break;case 3:for(const a of t)Je(a,a,n,r,i);t.add=t.clear=t.delete=rn;break;case 1:Object.freeze(t);let s=0;for(const a of t)Je(a,s,n,r,i),s+=1;break;default:Object.freeze(t),Object.keys(t).forEach(a=>{const c=t[a];Je(c,a,n,r,i)})}r.pop(),i.pop()}function ct(t,e){return t instanceof Map?t.has(e):Object.prototype.hasOwnProperty.call(t,e)}function on(t,e){if(e in t){let n=Reflect.getPrototypeOf(t);for(;n;){const r=Reflect.getOwnPropertyDescriptor(n,e);if(r)return r;n=Reflect.getPrototypeOf(n)}}}function At(t,e){const n=Fe(t);if(n===0)Reflect.ownKeys(t).forEach(r=>{e(r,t[r],t)});else if(n===1){let r=0;for(const i of t)e(r,i,t),r+=1}else t.forEach((r,i)=>e(i,r,t))}function sn(t,e,n){if(Ne(t)||!je(t,n)||e.has(t)||Object.isFrozen(t))return;const r=t instanceof Set,i=r?new Map:void 0;if(e.add(t),At(t,(o,s)=>{var a;if(Ne(s)){const c=$(s);he(c);const l=!((a=c.assignedMap)===null||a===void 0)&&a.size||c.operated?c.copy:c.original;Xe(r?i:t,o,l)}else sn(s,e,n)}),i){const o=t,s=Array.from(o);o.clear(),s.forEach(a=>{o.add(i.has(a)?i.get(a):a)})}}function vr(t,e){const n=t.type===3?t.setMap:t.copy;t.finalities.revoke.length>1&&t.assignedMap.get(e)&&n&&sn(Me(n,e),t.finalities.handledSet,t.options)}function Rt(t){t.type===3&&t.copy&&(t.copy.clear(),t.setMap.forEach(e=>{t.copy.add(St(e))}))}function xt(t,e,n,r){if(t.operated&&t.assignedMap&&t.assignedMap.size>0&&!t.finalized){if(n&&r){const o=tn(t);o&&e(t,o,n,r)}t.finalized=!0}}function It(t,e,n,r){const i=$(n);i&&(i.callbacks||(i.callbacks=[]),i.callbacks.push((o,s)=>{var a;const c=t.type===3?t.setMap:t.copy;if(Pe(Me(c,e),n)){let l=i.original;i.copy&&(l=i.copy),Rt(t),xt(t,r,o,s),t.options.enableAutoFreeze&&(t.options.updatedValues=(a=t.options.updatedValues)!==null&&a!==void 0?a:new WeakMap,t.options.updatedValues.set(l,i.original)),Xe(c,e,l)}}),t.options.enableAutoFreeze&&i.finalities!==t.finalities&&(t.options.enableAutoFreeze=!1)),je(n,t.options)&&t.finalities.draft.push(()=>{const o=t.type===3?t.setMap:t.copy;Pe(Me(o,e),n)&&vr(t,e)})}function br(t,e,n,r,i){let{original:o,assignedMap:s,options:a}=t,c=t.copy;c.length<o.length&&([o,c]=[c,o],[n,r]=[r,n]);for(let l=0;l<o.length;l+=1)if(s.get(l.toString())&&c[l]!==o[l]){const d=e.concat([l]),_=qe(d,i);n.push({op:ie.Replace,path:_,value:ut(c[l])}),r.push({op:ie.Replace,path:_,value:ut(o[l])})}for(let l=o.length;l<c.length;l+=1){const d=e.concat([l]),_=qe(d,i);n.push({op:ie.Add,path:_,value:ut(c[l])})}if(o.length<c.length){const{arrayLengthAssignment:l=!0}=a.enablePatches;if(l){const d=e.concat(["length"]),_=qe(d,i);r.push({op:ie.Replace,path:_,value:o.length})}else for(let d=c.length;o.length<d;d-=1){const _=e.concat([d-1]),P=qe(_,i);r.push({op:ie.Remove,path:P})}}}function gr({original:t,copy:e,assignedMap:n},r,i,o,s){n.forEach((a,c)=>{const l=Me(t,c),d=ut(Me(e,c)),_=a?ct(t,c)?ie.Replace:ie.Add:ie.Remove;if(Pe(l,d)&&_===ie.Replace)return;const P=r.concat(c),D=qe(P,s);i.push(_===ie.Remove?{op:_,path:D}:{op:_,path:D,value:d}),o.push(_===ie.Add?{op:ie.Remove,path:D}:_===ie.Remove?{op:ie.Add,path:D,value:l}:{op:ie.Replace,path:D,value:l})})}function _r({original:t,copy:e},n,r,i,o){let s=0;t.forEach(a=>{if(!e.has(a)){const c=n.concat([s]),l=qe(c,o);r.push({op:ie.Remove,path:l,value:a}),i.unshift({op:ie.Add,path:l,value:a})}s+=1}),s=0,e.forEach(a=>{if(!t.has(a)){const c=n.concat([s]),l=qe(c,o);r.push({op:ie.Add,path:l,value:a}),i.unshift({op:ie.Remove,path:l,value:a})}s+=1})}function et(t,e,n,r){const{pathAsArray:i=!0}=t.options.enablePatches;switch(t.type){case 0:case 2:return gr(t,e,n,r,i);case 1:return br(t,e,n,r,i);case 3:return _r(t,e,n,r,i)}}let mr=!1;const lt=(t,e,n=!1)=>{if(typeof t=="object"&&t!==null&&(!je(t,e)||n)&&!mr)throw new Error("Strict mode: Mutable data cannot be accessed directly, please use 'unsafe(callback)' wrap.")},Ct={get size(){return me($(this)).size},has(t){return me($(this)).has(t)},set(t,e){const n=$(this),r=me(n);return(!r.has(t)||!Pe(r.get(t),e))&&(he(n),xe(n),n.assignedMap.set(t,!0),n.copy.set(t,e),It(n,t,e,et)),this},delete(t){if(!this.has(t))return!1;const e=$(this);return he(e),xe(e),e.original.has(t)?e.assignedMap.set(t,!1):e.assignedMap.delete(t),e.copy.delete(t),!0},clear(){const t=$(this);if(this.size){he(t),xe(t),t.assignedMap=new Map;for(const[e]of t.original)t.assignedMap.set(e,!1);t.copy.clear()}},forEach(t,e){const n=$(this);me(n).forEach((r,i)=>{t.call(e,this.get(i),i,this)})},get(t){var e,n;const r=$(this),i=me(r).get(t),o=((n=(e=r.options).mark)===null||n===void 0?void 0:n.call(e,i,_e))===_e.mutable;if(r.options.strict&&lt(i,r.options,o),o||r.finalized||!je(i,r.options)||i!==r.original.get(t))return i;const s=Et.createDraft({original:i,parentDraft:r,key:t,finalities:r.finalities,options:r.options});return he(r),r.copy.set(t,s),s},keys(){return me($(this)).keys()},values(){const t=this.keys();return{[at]:()=>this.values(),next:()=>{const e=t.next();return e.done?e:{done:!1,value:this.get(e.value)}}}},entries(){const t=this.keys();return{[at]:()=>this.entries(),next:()=>{const e=t.next();if(e.done)return e;const n=this.get(e.value);return{done:!1,value:[e.value,n]}}}},[at](){return this.entries()}},wr=Reflect.ownKeys(Ct),an=(t,e,{isValuesIterator:n})=>()=>{var r,i;const o=e.next();if(o.done)return o;const s=o.value;let a=t.setMap.get(s);const c=$(a),l=((i=(r=t.options).mark)===null||i===void 0?void 0:i.call(r,a,_e))===_e.mutable;if(t.options.strict&&lt(s,t.options,l),!l&&!c&&je(s,t.options)&&!t.finalized&&t.original.has(s)){const d=Et.createDraft({original:s,parentDraft:t,key:s,finalities:t.finalities,options:t.options});t.setMap.set(s,d),a=d}else c&&(a=c.proxy);return{done:!1,value:n?a:[a,a]}},Tt={get size(){return $(this).setMap.size},has(t){const e=$(this);if(e.setMap.has(t))return!0;he(e);const n=$(t);return!!(n&&e.setMap.has(n.original))},add(t){const e=$(this);return this.has(t)||(he(e),xe(e),e.assignedMap.set(t,!0),e.setMap.set(t,t),It(e,t,t,et)),this},delete(t){if(!this.has(t))return!1;const e=$(this);he(e),xe(e);const n=$(t);return n&&e.setMap.has(n.original)?(e.assignedMap.set(n.original,!1),e.setMap.delete(n.original)):(!n&&e.setMap.has(t)?e.assignedMap.set(t,!1):e.assignedMap.delete(t),e.setMap.delete(t))},clear(){if(!this.size)return;const t=$(this);he(t),xe(t);for(const e of t.original)t.assignedMap.set(e,!1);t.setMap.clear()},values(){const t=$(this);he(t);const e=t.setMap.keys();return{[Symbol.iterator]:()=>this.values(),next:an(t,e,{isValuesIterator:!0})}},entries(){const t=$(this);he(t);const e=t.setMap.keys();return{[Symbol.iterator]:()=>this.entries(),next:an(t,e,{isValuesIterator:!1})}},keys(){return this.values()},[at](){return this.values()},forEach(t,e){const n=this.values();let r=n.next();for(;!r.done;)t.call(e,r.value,r.value,this),r=n.next()}},Er=Reflect.ownKeys(Tt),un=new WeakSet,cn={get(t,e,n){var r,i;const o=(r=t.copy)===null||r===void 0?void 0:r[e];if(o&&un.has(o))return o;if(e===en)return t;let s;if(t.options.mark){const l=e==="size"&&(t.original instanceof Map||t.original instanceof Set)?Reflect.get(t.original,e):Reflect.get(t.original,e,n);if(s=t.options.mark(l,_e),s===_e.mutable)return t.options.strict&&lt(l,t.options,!0),l}const a=me(t);if(a instanceof Map&&wr.includes(e)){if(e==="size")return Object.getOwnPropertyDescriptor(Ct,"size").get.call(t.proxy);const l=Ct[e];if(l)return l.bind(t.proxy)}if(a instanceof Set&&Er.includes(e)){if(e==="size")return Object.getOwnPropertyDescriptor(Tt,"size").get.call(t.proxy);const l=Tt[e];if(l)return l.bind(t.proxy)}if(!ct(a,e)){const l=on(a,e);return l?"value"in l?l.value:(i=l.get)===null||i===void 0?void 0:i.call(t.proxy):void 0}const c=a[e];if(t.options.strict&&lt(c,t.options),t.finalized||!je(c,t.options))return c;if(c===Ot(t.original,e)){if(he(t),t.copy[e]=Mt({original:t.original[e],parentDraft:t,key:t.type===1?Number(e):e,finalities:t.finalities,options:t.options}),typeof s=="function"){const l=$(t.copy[e]);return he(l),xe(l),l.copy}return t.copy[e]}return c},set(t,e,n){var r;if(t.type===3||t.type===2)throw new Error("Map/Set draft does not support any property assignment.");let i;if(t.type===1&&e!=="length"&&!(Number.isInteger(i=Number(e))&&i>=0&&(e===0||i===0||String(i)===String(e))))throw new Error("Only supports setting array indices and the 'length' property.");const o=on(me(t),e);if(o!=null&&o.set)return o.set.call(t.proxy,n),!0;const s=Ot(me(t),e),a=$(s);return a&&Pe(a.original,n)?(t.copy[e]=n,t.assignedMap=(r=t.assignedMap)!==null&&r!==void 0?r:new Map,t.assignedMap.set(e,!1),!0):(Pe(n,s)&&(n!==void 0||ct(t.original,e))||(he(t),xe(t),ct(t.original,e)&&Pe(n,t.original[e])?t.assignedMap.delete(e):t.assignedMap.set(e,!0),t.copy[e]=n,It(t,e,n,et)),!0)},has(t,e){return e in me(t)},ownKeys(t){return Reflect.ownKeys(me(t))},getOwnPropertyDescriptor(t,e){const n=me(t),r=Reflect.getOwnPropertyDescriptor(n,e);return r&&{writable:!0,configurable:t.type!==1||e!=="length",enumerable:r.enumerable,value:n[e]}},getPrototypeOf(t){return Reflect.getPrototypeOf(t.original)},setPrototypeOf(){throw new Error("Cannot call 'setPrototypeOf()' on drafts")},defineProperty(){throw new Error("Cannot call 'defineProperty()' on drafts")},deleteProperty(t,e){var n;return t.type===1?cn.set.call(this,t,e,void 0,t.proxy):(Ot(t.original,e)!==void 0||e in t.original?(he(t),xe(t),t.assignedMap.set(e,!1)):(t.assignedMap=(n=t.assignedMap)!==null&&n!==void 0?n:new Map,t.assignedMap.delete(e)),t.copy&&delete t.copy[e],!0)}};function Mt(t){const{original:e,parentDraft:n,key:r,finalities:i,options:o}=t,s=Fe(e),a={type:s,finalized:!1,parent:n,original:e,copy:null,proxy:null,finalities:i,options:o,setMap:s===3?new Map(e.entries()):void 0};(r||"key"in t)&&(a.key=r);const{proxy:c,revoke:l}=Proxy.revocable(s===1?Object.assign([],a):a,cn);if(i.revoke.push(l),un.add(c),a.proxy=c,n){const d=n;d.finalities.draft.push((_,P)=>{var D,O;const x=$(c);let w=d.type===3?d.setMap:d.copy;const A=Me(w,r),R=$(A);if(R){let j=R.original;R.operated&&(j=St(A)),Rt(R),xt(R,et,_,P),d.options.enableAutoFreeze&&(d.options.updatedValues=(D=d.options.updatedValues)!==null&&D!==void 0?D:new WeakMap,d.options.updatedValues.set(j,R.original)),Xe(w,r,j)}(O=x.callbacks)===null||O===void 0||O.forEach(j=>{j(_,P)})})}else{const d=$(c);d.finalities.draft.push((_,P)=>{Rt(d),xt(d,et,_,P)})}return c}Et.createDraft=Mt;function Sr(t,e,n,r,i){var o;const s=$(t),a=(o=s==null?void 0:s.original)!==null&&o!==void 0?o:t,c=!!e.length;if(s!=null&&s.operated)for(;s.finalities.draft.length>0;)s.finalities.draft.pop()(n,r);const l=c?e[0]:s?s.operated?s.copy:s.original:t;return s&&jt(s),i&&Je(l,l,s==null?void 0:s.options.updatedValues),[l,n&&c?[{op:ie.Replace,path:[],value:e[0]}]:n,r&&c?[{op:ie.Replace,path:[],value:a}]:r]}function Or(t,e){var n;const r={draft:[],revoke:[],handledSet:new WeakSet};let i,o;e.enablePatches&&(i=[],o=[]);const a=((n=e.mark)===null||n===void 0?void 0:n.call(e,t,_e))===_e.mutable||!je(t,e)?t:Mt({original:t,parentDraft:null,finalities:r,options:e});return[a,(c=[])=>{const[l,d,_]=Sr(a,c,i,o,e.enableAutoFreeze);return e.enablePatches?[l,d,_]:l}]}function Pt(t){const{rootDraft:e,value:n,useRawReturn:r=!1,isRoot:i=!0}=t;At(n,(o,s,a)=>{const c=$(s);if(c&&e&&c.finalities===e.finalities){t.isContainDraft=!0;const l=c.original;if(a instanceof Set){const d=Array.from(a);a.clear(),d.forEach(_=>a.add(o===_?l:_))}else Xe(a,o,l)}else typeof s=="object"&&s!==null&&(t.value=s,t.isRoot=!1,Pt(t))}),i&&(t.isContainDraft||console.warn("The return value does not contain any draft, please use 'rawReturn()' to wrap the return value to improve performance."),r&&console.warn("The return value contains drafts, please don't use 'rawReturn()' to wrap the return value."))}function ln(t){const e=$(t);if(!je(t,e==null?void 0:e.options))return t;const n=Fe(t);if(e&&!e.operated)return e.original;let r;function i(){r=n===2?new Map(t):n===3?Array.from(e.setMap.values()):nn(t,e==null?void 0:e.options)}if(e){e.finalized=!0;try{i()}finally{e.finalized=!1}}else r=t;return At(r,(o,s)=>{if(e&&Pe(Me(e.original,o),s))return;const a=ln(s);a!==s&&(r===t&&i(),Xe(r,o,a))}),n===3?new Set(r):r}function fn(t){if(!Ne(t))throw new Error(`current() is only used for Draft, parameter: ${t}`);return ln(t)}const jr=(t=>function e(n,r,i){var o,s,a;if(typeof n=="function"&&typeof r!="function")return function(U,...g){return e(U,S=>n.call(this,S,...g),r)};const c=n,l=r;let d=i;if(typeof r!="function"&&(d=r),d!==void 0&&Object.prototype.toString.call(d)!=="[object Object]")throw new Error(`Invalid options: ${d}, 'options' should be an object.`);d=Object.assign(Object.assign({},t),d);const _=Ne(c)?fn(c):c,P=Array.isArray(d.mark)?(U,g)=>{for(const S of d.mark){if(typeof S!="function")throw new Error(`Invalid mark: ${S}, 'mark' should be a function.`);const h=S(U,g);if(h)return h}}:d.mark,D=(o=d.enablePatches)!==null&&o!==void 0?o:!1,O=(s=d.strict)!==null&&s!==void 0?s:!1,w={enableAutoFreeze:(a=d.enableAutoFreeze)!==null&&a!==void 0?a:!1,mark:P,strict:O,enablePatches:D};if(!je(_,w)&&typeof _=="object"&&_!==null)throw new Error("Invalid base state: create() only supports plain objects, arrays, Set, Map or using mark() to mark the state as immutable.");const[A,R]=Or(_,w);if(typeof r!="function"){if(!je(_,w))throw new Error("Invalid base state: create() only supports plain objects, arrays, Set, Map or using mark() to mark the state as immutable.");return[A,R]}let j;try{j=l(A)}catch(U){throw jt($(A)),U}const M=U=>{const g=$(A);if(!Ne(U)){if(U!==void 0&&!Pe(U,A)&&(g!=null&&g.operated))throw new Error("Either the value is returned as a new non-draft value, or only the draft is modified without returning any value.");const h=U==null?void 0:U[dr];if(h){const v=h[0];return w.strict&&typeof U=="object"&&U!==null&&Pt({rootDraft:g,value:U,useRawReturn:!0}),R([v])}if(U!==void 0)return typeof U=="object"&&U!==null&&Pt({rootDraft:g,value:U}),R([U])}if(U===A||U===void 0)return R([]);const S=$(U);if(w===S.options){if(S.operated)throw new Error("Cannot return a modified child draft.");return R([fn(U)])}return R([U])};return j instanceof Promise?j.then(M,U=>{throw jt($(A)),U}):M(j)})();Object.prototype.constructor.toString();function dn(t,e){const n=Object.keys(t),r=Object.keys(e);return n.length===r.length&&Object.keys(t).every(i=>e.hasOwnProperty(i))}function hn(t,e){return Object.keys(t).length===Object.keys(e).length&&Object.keys(t).every(n=>e.hasOwnProperty(n)&&t[n]===e[n])}function ft(t,e){return typeof t!="object"||typeof e!="object"||t===null||e===null?t===e:dn(t,e)?Object.keys(t).every(n=>ft(t[n],e[n])):!1}function pn(t,e){if(!Qe(t)||!Qe(e))return e;const n={};for(const r of Object.keys(t))e[r]!==null&&(n[r]=t[r]);for(const r of Object.keys(e)){if(e[r]===null)continue;const i=Qe(t[r])&&Qe(e[r]);n[r]=i?pn(t[r],e[r]):e[r]}return n}function yn(t,e,n){if(!Qe(t))return t;const r={};for(const[i,o]of Object.entries(t))r[i]=Qe(o)?yn(o,e,n):o===e?n:o;return r}function Qe(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}function Ar(t){return t.cardinality==="one"}function kt(t){return t["value-type"]==="ref"}function vn(t){return t["value-type"]==="blob"}function dt(t,e){return t[e]}function Ut(t,e){return e.reduce((n,r)=>n&&n.get(r),t)}function Ae(t,e){if(e.length===0)throw new Error("path must have at least one element");if(e.length===1){t.delete(e[0]);return}const[n,...r]=e;t.has(n)&&Ae(t.get(n),r)}function Ie(t,e,n){if(e.length===0)throw new Error("path must have at least one element");if(e.length===1){t.set(e[0],n);return}const[r,...i]=e;let o=t.get(r);o||(o=new Map,t.set(r,o)),Ie(o,i,n)}function bn(t,e){const n=new Map,r=new Map,i=new Map;for(const o of e){const[s,a,c,l]=o,d=dt(t,a);if(!d){console.warn("no such attr",s,t);continue}kt(d)&&Ie(i,[c,a,s],o),Ie(n,[s,a,c],o),Ie(r,[a,s,c],o)}return{eav:n,aev:r,vae:i}}function Rr({attrs:t},e){return Object.values(t).filter(n=>vn(n)&&n["forward-identity"][1]===e)}function xr(t,e,n){var r;const i={};for(const o of e){const s=(r=t.eav.get(n))===null||r===void 0?void 0:r.get(o.id),a=Re(s,1);for(const c of a)i[o["forward-identity"][2]]=c[2]}return i}function Ir(t){return{__type:t.__type,attrs:t.attrs,triples:Re(t.eav,3),cardinalityInference:t.cardinalityInference,linkIndex:t.linkIndex}}function Cr(t){return Lt(t.attrs,t.triples,t.cardinalityInference,t.linkIndex)}function Lt(t,e,n,r){const i=bn(t,e);return i.attrs=t,i.cardinalityInference=n,i.linkIndex=r,i.__type="store",i}function ht(t,e){var n,r;let i;if(Array.isArray(e[0])){const[s,a]=e[0],c=t.aev.get(s);if(!c)return null;i=(n=Re(c,2).find(d=>d[2]===a))===null||n===void 0?void 0:n[0]}else i=e[0];if(!i)return null;const o=e[2];if(Array.isArray(o)&&o.length===2&&t.aev.get(o[0])){const[s,a]=o,c=t.aev.get(s);if(!c)return null;const d=(r=Re(c,2).find(x=>x[2]===a))===null||r===void 0?void 0:r[0];if(!d)return null;const[_,P,D,...O]=e;return[i,P,d,...O]}else{const[s,...a]=e;return[i,...a]}}function Tr(t,e){const n=ht(t,e);if(!n)return;const[r,i,o]=n,s=dt(t.attrs,i);s&&(Ae(t.eav,[r,i,o]),Ae(t.aev,[i,r,o]),kt(s)&&Ae(t.vae,[o,i,r]))}let Mr=0;function gn(t,e,n){const[r,i,o]=n;let s;const a=Ut(t.ea,[r,i,o]);return a&&(s=a[3]),s||Date.now()*10+Mr++}function Pr(t,e){var n;const r=ht(t,e);if(!r)return;const[i,o,s]=r,a=dt(t.attrs,o);if(!a)return;const c=Ut(t.eav,[i,o,s]),l=(n=c==null?void 0:c[3])!==null&&n!==void 0?n:gn(t,a,r),d=[i,o,s,l];Ar(a)?(Ie(t.eav,[i,o],new Map([[s,d]])),Ie(t.aev,[o,i],new Map([[s,d]]))):(Ie(t.eav,[i,o,s],d),Ie(t.aev,[o,i,s],d)),kt(a)&&Ie(t.vae,[s,o,i],d)}function kr(t,e){var n;const r=ht(t,e);if(!r)return;const[i,o,s]=r,a=dt(t.attrs,o);if(!a)return;if(!vn(a))throw new Error("merge operation is not supported for links");const c=Ut(t.eav,[i,o]);if(!c)return;const l=(n=c.values().next())===null||n===void 0?void 0:n.value;if(!l)return;const d=l[2],_=pn(d,s),P=[i,o,_,gn(t,a,l)];Ie(t.eav,[i,o],new Map([[_,P]]))}function Ur(t,e){var n,r;const[i,o]=e,s=ht(t,[i]);if(!s)return;const[a]=s,c=t.eav.get(a);if(c){for(const d of c.keys()){const _=t.attrs[d];(!o||!_||((n=_["forward-identity"])===null||n===void 0?void 0:n[1])===o)&&(Ae(t.aev,[d,a]),Ae(t.eav,[a,d]))}c.size===0&&Ae(t.eav,[a])}const l=t.vae.get(a)&&Re(t.vae.get(a),2);l&&l.forEach(d=>{var _;const[P,D,O]=d,x=t.attrs[D];(!o||!x||((_=x["reverse-identity"])===null||_===void 0?void 0:_[1])===o)&&(Ae(t.eav,[P,D,O]),Ae(t.aev,[D,P,O]),Ae(t.vae,[O,D,P]))}),((r=t.vae.get(a))===null||r===void 0?void 0:r.size)===0&&Ae(t.vae,[a])}function _n(t,e){const n=bn(t.attrs,e);Object.keys(n).forEach(r=>{t[r]=n[r]})}function Lr(t,[e]){t.attrs[e.id]=e}function mn(t){return Re(t.eav,3)}function Dr(t,[e]){if(!t.attrs[e])return;const n=mn(t).filter(([r,i])=>i!==e);delete t.attrs[e],_n(t,n)}function Br(t,[e]){const n=t.attrs[e.id];n&&(t.attrs[e.id]=Object.assign(Object.assign({},n),e),_n(t,mn(t)))}function Nr(t,e){const[n,...r]=e;switch(n){case"add-triple":Pr(t,r);break;case"deep-merge-triple":kr(t,r);break;case"retract-triple":Tr(t,r);break;case"delete-entity":Ur(t,r);break;case"add-attr":Lr(t,r);break;case"delete-attr":Dr(t,r);break;case"update-attr":Br(t,r);break;default:throw new Error(`unhandled transaction action: ${n}`)}}function Re(t,e,n=[]){if(!t||e===0)return n;if(e===1){for(const r of t.values())n.push(r);return n}for(const r of t.values())Re(r,e-1,n);return n}function pt(t,e){const n=[],r=e.in?e.in:[e];for(const i of r){const o=t.get(i);o&&n.push(o)}return n}function Fr(t,e,n){let r="";return t!==void 0&&(r+="e"),e!==void 0&&(r+="a"),n!==void 0&&(r+="v"),r}function qr(t,[e,n,r]){var i,o;switch(Fr(e,n,r)){case"e":{const a=t.eav.get(e);return Re(a,2)}case"ea":{const a=(i=t.eav.get(e))===null||i===void 0?void 0:i.get(n);return Re(a,1)}case"eav":{const a=(o=t.eav.get(e))===null||o===void 0?void 0:o.get(n);return a?pt(a,r):[]}case"ev":{const a=t.eav.get(e);if(!a)return[];const c=[];for(const l of a.values())c.push(...pt(l,r));return c}case"a":{const a=t.aev.get(n);return Re(a,2)}case"av":{const a=t.aev.get(n);if(!a)return[];const c=[];for(const l of a.values())c.push(...pt(l,r));return c}case"v":{const a=[];for(const c of t.eav.values())for(const l of c.values())a.push(...pt(l,r))}default:return Re(t.eav,3)}}function zr(t,e){return jr(t,n=>{e.forEach(r=>{Nr(n,r)})})}function Vr(t){return typeof t=="string"&&t.startsWith("?")}function Wr(t,e,n){if(n.hasOwnProperty(t)){const r=n[t];return En(r,e,n)}return Object.assign(Object.assign({},n),{[t]:e})}function wn(t,e,n){return t===e?n:null}function $r(t,e,n){const{in:r}=t;return r&&r.includes(e)?n:null}function Yr(t){switch(typeof t){case"string":return t.startsWith("?")?Wr:wn;case"object":return $r;default:return wn}}function En(t,e,n){return n?Yr(t)(t,e,n):null}function Jr(t,e,n){return t.reduce((r,i,o)=>{const s=e[o];return En(i,s,r)},n)}function Qr(t,e,n){return Gr(t,e,n).map(r=>Jr(e,r,n)).filter(r=>r)}function Kr(t,e,n){return e.or?e.or.patterns.flatMap(r=>Dt(t,r,n)):e.and?e.and.patterns.reduce((r,i)=>Dt(t,i,r),n):n.flatMap(r=>Qr(t,e,r))}function Dt(t,e,n=[{}]){return e.reduce((r,i)=>Kr(t,i,r),n)}function Bt(t,e){return Array.isArray(e)?e.map(n=>Bt(t,n)):Vr(e)?t[e]:e}function Hr(t,{find:e,where:n}){return Dt(t,n).map(i=>Bt(i,e))}function Gr(t,e,n){return qr(t,Bt(n,e))}let yt;const Xr=new Uint8Array(16);function Zr(){if(!yt&&(yt=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!yt))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return yt(Xr)}const ce=[];for(let t=0;t<256;++t)ce.push((t+256).toString(16).slice(1));function ei(t,e=0){return ce[t[e+0]]+ce[t[e+1]]+ce[t[e+2]]+ce[t[e+3]]+"-"+ce[t[e+4]]+ce[t[e+5]]+"-"+ce[t[e+6]]+ce[t[e+7]]+"-"+ce[t[e+8]]+ce[t[e+9]]+"-"+ce[t[e+10]]+ce[t[e+11]]+ce[t[e+12]]+ce[t[e+13]]+ce[t[e+14]]+ce[t[e+15]]}const Sn={randomUUID:typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function ti(t,e,n){if(Sn.randomUUID&&!e&&!t)return Sn.randomUUID();t=t||{};const r=t.random||(t.rng||Zr)();return r[6]=r[6]&15|64,r[8]=r[8]&63|128,ei(r)}function On(t){const e=t.replace(/-/g,""),n=[];for(let r=0;r<e.length;r+=2)n.push(parseInt(e.substring(r,r+2),16));return n}function ni(t,e){for(let n=0;n<t.length;n++){if(t[n]<e[n])return-1;if(t[n]>e[n])return 1}return 0}function jn(t,e){return ni(On(t),On(e))}function pe(){return ti()}function Nt(t,e,n){return new Proxy({},{get:(r,i)=>i==="__ops"?n:o=>Nt(t,e,[...n,[i,t,e,o]])})}function ri(t,e){return`lookup__${t}__${JSON.stringify(e)}`}function Ft(t){return t.startsWith("lookup__")}function An(t){const[e,n,...r]=t.split("__");return[n,JSON.parse(r.join("__"))]}function ii(t){return new Proxy({},{get(e,n){return Ft(n)?Nt(t,An(n),[]):Nt(t,n,[])}})}function qt(){return new Proxy({},{get(t,e){return ii(e)}})}const oi=qt();function si(t){return t.__ops}function ai(t,e){const{attrIdMap:n,refSwapAttrIds:r}=t,i=[];for(const s of e){const a=n[s];if(a)i.push(a);else if(Array.isArray(s)&&s.length==2&&n[s[0]]){const[c,l]=s;i.push([n[c],l])}else i.push(s)}const[o]=e;if((o==="add-triple"||o==="retract-triple")&&r.has(e[2])){const s=i[1];i[1]=i[3],i[3]=s}return i}function ye(t,e,n){return Object.values(t).find(r=>{const[i,o,s]=r["forward-identity"];return o===e&&s===n})}function Ke(t,e,n){return Object.values(t).find(r=>{const i=r["reverse-identity"];if(!i)return!1;const[o,s,a]=i;return s===e&&a===n})}function ui(t){if(Array.isArray(t))return t;const e=Object.entries(t);if(e.length!==1)throw new Error("lookup must be an object with a single unique attr and value.");return e[0]}function Rn(t,e,n){return n.indexOf(".")!==-1&&!ye(t,e,n)}function xn(t){const[e,n,...r]=t.split(".");if(r.length>0||n!=="id")throw new Error(`${t} is not a valid lookup attribute.`);return e}function ci(t,e,n){if(!Rn(t,e,n))return ye(t,e,n);const r=xn(n),i=ye(t,e,r);if(i&&i["value-type"]!=="ref")throw new Error(`${n} does not reference a valid link attribute.`);return i}function In(t){return typeof t=="string"&&!Ft(t)?null:typeof t=="string"&&Ft(t)?An(t):ui(t)}function Se(t,e,n){const r=In(n);if(r===null)return n;const[i,o]=r,s=ci(t,e,i);if(!s||!s["unique?"])throw new Error(`${i} is not a unique attribute.`);return[s.id,o]}function li(t,[e,n,r]){return Object.entries(r).flatMap(([o,s])=>{const a=Array.isArray(s)?s:[s],c=ye(t,e,o),l=Ke(t,e,o);return a.map(d=>c?["add-triple",Se(t,e,n),c.id,Se(t,c["reverse-identity"][1],d)]:["add-triple",Se(t,l["forward-identity"][1],d),l.id,Se(t,e,n)])})}function fi(t,[e,n,r]){return Object.entries(r).flatMap(([o,s])=>{const a=Array.isArray(s)?s:[s],c=ye(t,e,o),l=Ke(t,e,o);return a.map(d=>c?["retract-triple",Se(t,e,n),c.id,Se(t,c["reverse-identity"][1],d)]:["retract-triple",Se(t,l["forward-identity"][1],d),l.id,Se(t,e,n)])})}function di(t,[e,n,r]){const i=Se(t,e,n);return[["id",Se(t,e,n)]].concat(Object.entries(r)).map(([s,a])=>{const c=ye(t,e,s);return["add-triple",i,c.id,a]})}function hi(t,[e,n]){return[["delete-entity",Se(t,e,n),e]]}function pi(t,[e,n,r]){const i=Se(t,e,n),o=Object.entries(r).map(([a,c])=>{const l=ye(t,e,a),d=yn(c,void 0,null);return["deep-merge-triple",i,l.id,d]});return[["add-triple",i,ye(t,e,"id").id,i]].concat(o)}function yi(t,[e,...n]){switch(e){case"merge":return pi(t,n);case"update":return di(t,n);case"link":return li(t,n);case"unlink":return fi(t,n);case"delete":return hi(t,n);default:throw new Error(`unsupported action ${e}`)}}function Cn(t,e,n){const r=pe(),o=[pe(),t,e];return Object.assign({id:r,"forward-identity":o,"value-type":"blob",cardinality:"one","unique?":!1,"index?":!1,isUnsynced:!0},n||{})}function Tn(t,e,n){const r=pe(),i=pe(),o=pe();return Object.assign({id:r,"forward-identity":[i,t,e],"reverse-identity":[o,e,t],"value-type":"ref",cardinality:"many","unique?":!1,"index?":!1,isUnsynced:!0},n||{})}const vi=new Set(["update","merge","link","unlink"]),bi=new Set(["link","unlink"]),gi=new Set(["update","merge"]),_i=new Set(["link","unlink","update","merge","delete"]),Mn={"unique?":!0,"index?":!0},mi=Object.assign(Object.assign({},Mn),{cardinality:"one"});function wi(t,e){const[n,r,i]=[new Set,Object.assign({},t),[]];function o(a){r[a.id]=a,i.push(["add-attr",a]),n.add(a.id)}function s(a){a!=null&&a.isUnsynced&&!n.has(a.id)&&(i.push(["add-attr",a]),n.add(a.id))}for(const a of e){const[c,l,d,_]=a;if(_i.has(c)){const P=In(d);if(P){const D=P[0];if(Rn(r,l,D)){const O=xn(D),x=ye(r,l,O),w=Ke(r,l,O);!x&&!w&&o(Tn(l,O,mi)),s(x),s(w)}else{const O=ye(r,l,D);O||o(Cn(l,D,Mn)),s(O)}}}}for(const a of e){const[c,l,d,_]=a;if(vi.has(c)){const P=Object.keys(_);P.push("id");for(const D of P){const O=ye(r,l,D);if(s(O),gi.has(c)&&(O||o(Cn(l,D))),bi.has(c)){const x=Ke(r,l,D);!O&&!x&&o(Tn(l,D)),s(x)}}}}return[r,i]}function Ei(t,e){const r=(Array.isArray(e)?e:[e]).flatMap(a=>si(a)),[i,o]=wi(t,r),s=r.flatMap(a=>yi(i,a));return[...o,...s]}let Si=0;function zt(t){return vt(`_${t}`,Si++)}function vt(t,e){return`?${t}-${e}`}class tt extends Error{constructor(e){super(e),this.name="AttrNotFoundError"}}function Oi(t,e){const n=Object.values(t.attrs).find(r=>{var i;return r["primary?"]&&((i=r["forward-identity"])===null||i===void 0?void 0:i[1])===e});return n||ye(t.attrs,e,"id")}function Pn(t,e){const n=Oi(t,e);if(!n)throw new tt(`Could not find id attr for ${e}`);return n}function kn(t,e,n,r){return[ji(t,e,n,r)]}function ji(t,e,n,r){return[t(n,r),Pn(e,n).id,t(n,r),t("time",r)]}function Ai(t,e,n){return t.map(r=>r===e?n:r)}function Un(t,e,n,r,i){const o=ye(e.attrs,n,i),s=Ke(e.attrs,n,i),a=o||s;if(!a)throw new tt(`Could not find attr for ${[n,i]}`);if(a["value-type"]!=="ref")throw new Error(`Attr ${a.id} is not a ref`);const[c,l]=a["forward-identity"],[d,_]=a["reverse-identity"],P=r+1,D=o?[t(l,r),a.id,t(_,P),zt("time")]:[t(l,P),a.id,t(_,r),zt("time")];return[o?_:l,P,D,a,!!o]}function Ri(t,e,n,r,i,o){const s=ye(e.attrs,n,i);if(!s)throw new tt(`No attr for etype = ${n} label = ${i} value-label`);return[t(n,r),s.id,o,zt("time")]}function xi(t,e,n,r,i){const[o,s,a]=i.reduce((c,l)=>{const[d,_,P]=c,[D,O,x]=Un(t,e,d,_,l);return[D,O,[...P,x]]},[n,r,[]]);return[o,s,a]}function Ii(t,e,n,r,i,o){const s=i.slice(0,i.length-1),a=i[i.length-1],[c,l,d]=xi(t,e,n,r,s),_=Ri(t,e,c,l,a,o);return d.concat([_])}function Ci(t,e){return e?[e].concat(t):t}function Ti([t,e]){return t==="or"&&Array.isArray(e)}function Mi([t,e]){return t==="and"&&Array.isArray(e)}function Pi(t,e,n){return(r,i)=>r==e?t(r,i):`${t(r,i)}-${n}`}function Ln(t,e,n,r,i,o){const s=o.map((c,l)=>{const d=Pi(t,r,l);return Dn(d,n,r,i,c)}),a=t(r,i);return{[e]:{patterns:s,joinSym:a}}}function Dn(t,e,n,r,i){return Object.entries(i).flatMap(([o,s])=>{if(Ti([o,s]))return Ln(t,"or",e,n,r,s);if(Mi([o,s]))return Ln(t,"and",e,n,r,s);const a=o.split(".");return Ii(t,e,n,r,a,s)})}function ki(t,e,n,r){const i=vt;return r?Dn(i,t,e,n,r).concat(kn(i,t,e,n)):kn(i,t,e,n)}function Ui(t,e,n){return[t(e,n),t("time",n)]}function Li(t,e,n,r,i,o){const[s,a,c,l,d]=Un(t,e,n,r,i),_=Ai(c,t(n,r),o);return[s,a,_,l,d]}function Di(t,e,{etype:n,level:r,form:i},o){const s=Object.keys(i).filter(a=>a!=="$");return s.length?Object.entries(o).map(([a,c])=>s.map(d=>{var _,P,D;const O=!!(e.cardinalityInference&&(!((D=(P=(_=e.linkIndex)===null||_===void 0?void 0:_[n])===null||P===void 0?void 0:P[d])===null||D===void 0)&&D.isSingular));try{const[x,w,A]=Li(t,e,n,r,d,a),R=Nn(e,{etype:x,level:w,form:i[d],join:A}),j=O?R[0]:R;return{[d]:j}}catch(x){if(x instanceof tt)return{[d]:O?void 0:[]};throw x}}).reduce((d,_)=>Object.assign(Object.assign({},d),_),c)):Object.values(o)}function Bn(t,e){switch(t){case"asc":switch(e){case"number":return(n,r)=>n<r;case"uuid":return(n,r)=>jn(n,r)===-1}case"desc":switch(e){case"number":return(n,r)=>n>r;case"uuid":return(n,r)=>jn(n,r)===1}}}function Bi(t,e,[n,r,i,o]){return Bn(e,"number")(o,t[3])||o===t[3]&&Bn(e,"uuid")(n,t[0])}function Ni(t,e,n,r,i){const o=Pn(t,e).id,s=Hr(t,i).sort(([d,_],[P,D])=>n==="desc"?D-_:_-D);let a={};const c=r==null?void 0:r["start-cursor"],l=Rr(t,e);for(const[d,_]of s){if(c&&o===c[1]&&Bi(c,n,[d,o,d,_]))continue;const P=xr(t,l,d);P&&(a[d]=P)}return a}function Fi(t){var e;const n=(e=t.$)===null||e===void 0?void 0:e.order;return n&&n[Object.keys(n)[0]]||"asc"}function qi(t,{etype:e,level:n,form:r,join:i,pageInfo:o}){var s,a,c,l,d,_,P;const D=((s=r.$)===null||s===void 0?void 0:s.limit)||((a=r.$)===null||a===void 0?void 0:a.first)||((c=r.$)===null||c===void 0?void 0:c.last),O=(l=r.$)===null||l===void 0?void 0:l.offset,x=(d=r.$)===null||d===void 0?void 0:d.before,w=(_=r.$)===null||_===void 0?void 0:_.after;if((O||x||w)&&(!o||!o["start-cursor"]))return[];const A=Ci(ki(t,e,n,(P=r.$)===null||P===void 0?void 0:P.where),i),R=Ui(vt,e,n),j=Ni(t,e,Fi(r),o,{where:A,find:R});if(D!=null){const M=Object.entries(j);return M.length<=D?j:Object.fromEntries(M.slice(0,D))}return j}function zi(t,e){try{return qi(t,e)}catch(n){if(n instanceof tt)return{};throw n}}function Nn(t,e){const n=zi(t,e);return Di(vt,t,e,n)}function Vi(t){const e={};for(const[n,r]of Object.entries(t))e[n]={startCursor:r["start-cursor"],endCursor:r["end-cursor"],hasNextPage:r["has-next-page?"],hasPreviousPage:r["has-previous-page?"]};return e}function Wi({store:t,pageInfo:e,aggregate:n},r){const o={data:Object.keys(r).reduce((s,a)=>(n!=null&&n[a]||(s[a]=Nn(t,{etype:a,form:r[a],level:0,pageInfo:e==null?void 0:e[a]})),s),{})};return e&&(o.pageInfo=Vi(e)),n&&(o.aggregate=n),o}var Fn=function(t,e,n,r){function i(o){return o instanceof n?o:new n(function(s){s(o)})}return new(n||(n=Promise))(function(o,s){function a(d){try{l(r.next(d))}catch(_){s(_)}}function c(d){try{l(r.throw(d))}catch(_){s(_)}}function l(d){d.done?o(d.value):i(d.value).then(a,c)}l((r=r.apply(t,e||[])).next())})};class qn{constructor(e){this.dbName=e,this._storeName="kv",this._dbPromise=this._init()}_init(){return new Promise((e,n)=>{const r=indexedDB.open(this.dbName,1);r.onerror=i=>{n(i)},r.onsuccess=i=>{e(i.target.result)},r.onupgradeneeded=i=>{i.target.result.createObjectStore(this._storeName)}})}getItem(e){return Fn(this,void 0,void 0,function*(){const n=yield this._dbPromise;return new Promise((r,i)=>{const a=n.transaction([this._storeName],"readonly").objectStore(this._storeName).get(e);a.onerror=c=>{i(c)},a.onsuccess=c=>{a.result?r(a.result):r(null)}})})}setItem(e,n){return Fn(this,void 0,void 0,function*(){const r=yield this._dbPromise;return new Promise((i,o)=>{const c=r.transaction([this._storeName],"readwrite").objectStore(this._storeName).put(n,e);c.onerror=l=>{o(l)},c.onsuccess=l=>{i()}})})}}var $i=function(t,e,n,r){function i(o){return o instanceof n?o:new n(function(s){s(o)})}return new(n||(n=Promise))(function(o,s){function a(d){try{l(r.next(d))}catch(_){s(_)}}function c(d){try{l(r.throw(d))}catch(_){s(_)}}function l(d){d.done?o(d.value):i(d.value).then(a,c)}l((r=r.apply(t,e||[])).next())})};class zn{static getIsOnline(){return $i(this,void 0,void 0,function*(){return navigator.onLine})}static listen(e){const n=()=>{e(!0)},r=()=>{e(!1)};return addEventListener("online",n),addEventListener("offline",r),()=>{removeEventListener("online",n),removeEventListener("offline",r)}}}var Yi=function(t,e,n,r){function i(o){return o instanceof n?o:new n(function(s){s(o)})}return new(n||(n=Promise))(function(o,s){function a(d){try{l(r.next(d))}catch(_){s(_)}}function c(d){try{l(r.throw(d))}catch(_){s(_)}}function l(d){d.done?o(d.value):i(d.value).then(a,c)}l((r=r.apply(t,e||[])).next())})};function ke(t,e){return Yi(this,void 0,void 0,function*(){const n=yield fetch(t,e),r=yield n.json();return n.status===200?Promise.resolve(r):Promise.reject({status:n.status,body:r})})}var nt=function(t,e,n,r){function i(o){return o instanceof n?o:new n(function(s){s(o)})}return new(n||(n=Promise))(function(o,s){function a(d){try{l(r.next(d))}catch(_){s(_)}}function c(d){try{l(r.throw(d))}catch(_){s(_)}}function l(d){d.done?o(d.value):i(d.value).then(a,c)}l((r=r.apply(t,e||[])).next())})};function Ji({apiURI:t,appId:e,email:n}){return ke(`${t}/runtime/auth/send_magic_code`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({"app-id":e,email:n})})}function Qi(t){return nt(this,arguments,void 0,function*({apiURI:e,appId:n,email:r,code:i}){return yield ke(`${e}/runtime/auth/verify_magic_code`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({"app-id":n,email:r,code:i})})})}function Ki(t){return nt(this,arguments,void 0,function*({apiURI:e,appId:n,refreshToken:r}){return yield ke(`${e}/runtime/auth/verify_refresh_token`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({"app-id":n,"refresh-token":r})})})}function Vn(t){return nt(this,arguments,void 0,function*({apiURI:e,appId:n,code:r,codeVerifier:i}){return yield ke(`${e}/runtime/oauth/token`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({app_id:n,code:r,code_verifier:i})})})}function Hi(t){return nt(this,arguments,void 0,function*({apiURI:e,appId:n,nonce:r,idToken:i,clientName:o,refreshToken:s}){return yield ke(`${e}/runtime/oauth/id_token`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({app_id:n,nonce:r,id_token:i,client_name:o,refresh_token:s})})})}function Gi(t){return nt(this,arguments,void 0,function*({apiURI:e,appId:n,refreshToken:r}){return yield ke(`${e}/runtime/signout`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({app_id:n,refresh_token:r})})})}var bt=function(t,e,n,r){function i(o){return o instanceof n?o:new n(function(s){s(o)})}return new(n||(n=Promise))(function(o,s){function a(d){try{l(r.next(d))}catch(_){s(_)}}function c(d){try{l(r.throw(d))}catch(_){s(_)}}function l(d){d.done?o(d.value):i(d.value).then(a,c)}l((r=r.apply(t,e||[])).next())})};function Xi(t){return bt(this,arguments,void 0,function*({apiURI:e,appId:n,fileName:r,refreshToken:i,metadata:o={}}){const{data:s}=yield ke(`${e}/storage/signed-upload-url`,{method:"POST",headers:{"content-type":"application/json",authorization:`Bearer ${i}`},body:JSON.stringify({app_id:n,filename:r})});return s})}function Zi(t,e){return bt(this,void 0,void 0,function*(){return(yield fetch(t,{method:"PUT",body:e,headers:{"Content-Type":e.type}})).ok})}function eo(t){return bt(this,arguments,void 0,function*({apiURI:e,appId:n,path:r,refreshToken:i}){const{data:o}=yield ke(`${e}/storage/signed-download-url?app_id=${n}&filename=${encodeURIComponent(r)}`,{method:"GET",headers:{"content-type":"application/json",authorization:`Bearer ${i}`}});return o})}function to(t){return bt(this,arguments,void 0,function*({apiURI:e,appId:n,path:r,refreshToken:i}){const{data:o}=yield ke(`${e}/storage/files?app_id=${n}&filename=${encodeURIComponent(r)}`,{method:"DELETE",headers:{"content-type":"application/json",authorization:`Bearer ${i}`}});return o})}function Wn(t,e){if(!e)return t;const n={};return e.forEach(r=>{n[r]=t[r]}),n}function no(t,e,n){var r,i;const o={peers:{}};if(e&&"user"in e?e.user:!0){const a=Wn((r=t.user)!==null&&r!==void 0?r:{},e==null?void 0:e.keys);o.user=Object.assign(Object.assign({},a),{peerId:n})}for(const a of Object.keys((i=t.peers)!==null&&i!==void 0?i:{})){const c=(e==null?void 0:e.peers)===void 0,l=Array.isArray(e==null?void 0:e.peers)&&(e==null?void 0:e.peers.includes(a));if(c||l){const d=Wn(t.peers[a],e==null?void 0:e.keys);o.peers[a]=Object.assign(Object.assign({},d),{peerId:a})}}return o}function ro(t,e){if(t.isLoading!==e.isLoading||t.error!==e.error||(t.user||e.user)&&(!t.user||!e.user||!hn(t.user,e.user))||!dn(t.peers,e.peers))return!0;for(const r of Object.keys(t.peers))if(!hn(t.peers[r],e.peers[r]))return!0;return!1}class $n{constructor(){this.promise=new Promise((e,n)=>{this._resolve=e,this._reject=n})}resolve(e){this._resolve(e)}reject(e){this._reject(e)}}var gt=function(t,e,n,r){function i(o){return o instanceof n?o:new n(function(s){s(o)})}return new(n||(n=Promise))(function(o,s){function a(d){try{l(r.next(d))}catch(_){s(_)}}function c(d){try{l(r.throw(d))}catch(_){s(_)}}function l(d){d.done?o(d.value):i(d.value).then(a,c)}l((r=r.apply(t,e||[])).next())})};class Yn{constructor(e,n,r,i,o=c=>JSON.stringify(c),s=c=>JSON.parse(c),a=100){this._persister=e,this._key=n,this._onMerge=i,this._loadedCbs=[],this._isLoading=!0,this.currentValue=r,this.toJSON=o,this.fromJSON=s,this._saveThrottleMs=a,this._pendingSaveCbs=[],this._version=0,this._load()}_load(){return gt(this,void 0,void 0,function*(){const e=this.fromJSON(yield this._persister.getItem(this._key));this._isLoading=!1,this._onMerge(e,this.currentValue);for(const n of this._loadedCbs)n()})}waitForLoaded(){return gt(this,void 0,void 0,function*(){if(!this._isLoading)return;yield new Promise(n=>{this._loadedCbs.push(n)})})}isLoading(){return this._isLoading}version(){return this._version}waitForSync(){return gt(this,void 0,void 0,function*(){if(!this._nextSave)return;yield new Promise(n=>{this._pendingSaveCbs.push(n)})})}_writeToStorage(){this._persister.setItem(this._key,this.toJSON(this.currentValue));for(const e of this._pendingSaveCbs)e();this._pendingSaveCbs.length=0}flush(){return gt(this,void 0,void 0,function*(){this._nextSave&&(clearTimeout(this._nextSave),this._writeToStorage())})}_enqueuePersist(e){if(this._nextSave){e&&this._pendingSaveCbs.push(e);return}this._nextSave=setTimeout(()=>{this._nextSave=null,this._writeToStorage()},this._saveThrottleMs)}set(e,n){this._version++,this.currentValue=e(this.currentValue),this._isLoading?this._loadedCbs.push(()=>this._enqueuePersist(n)):this._enqueuePersist(n)}}function Jn(t,e=[]){t.forEach(n=>{const{data:r}=n,{"datalog-result":i}=r,{"join-rows":o}=i;for(const s of o)for(const a of s)e.push(a);Jn(n["child-nodes"],e)})}function Qn(t){const e=[];return Jn(t,e),e}function io(t){return Object.values(t.links).reduce((e,n)=>{var r,i,o,s;return(r=e[o=n.forward.on])!==null&&r!==void 0||(e[o]={}),e[n.forward.on][n.forward.label]={isForward:!0,isSingular:n.forward.has==="one",link:n},(i=e[s=n.reverse.on])!==null&&i!==void 0||(e[s]={}),e[n.reverse.on][n.reverse.label]={isForward:!1,isSingular:n.reverse.has==="one",link:n},e},{})}var le=function(t,e,n,r){function i(o){return o instanceof n?o:new n(function(s){s(o)})}return new(n||(n=Promise))(function(o,s){function a(d){try{l(r.next(d))}catch(_){s(_)}}function c(d){try{l(r.throw(d))}catch(_){s(_)}}function l(d){d.done?o(d.value):i(d.value).then(a,c)}l((r=r.apply(t,e||[])).next())})};const ze={CONNECTING:"connecting",OPENED:"opened",AUTHENTICATED:"authenticated",CLOSED:"closed",ERRORED:"errored"},oo=1e4,Kn=1,so={apiURI:"https://api.instantdb.com",websocketURI:"wss://api.instantdb.com/runtime/session"},Vt="_instant_oauth_redirect",Wt="currentUser";function ao(){return typeof window<"u"||typeof chrome<"u"}function uo(t){var e;const n=JSON.parse(t);for(const r in n){const i=n[r];!((e=i==null?void 0:i.result)===null||e===void 0)&&e.store&&(i.result.store=Cr(i.result.store))}return n}function co(t){var e;const n={};for(const r in t){const i=t[r],o=Object.assign({},i);!((e=i.result)===null||e===void 0)&&e.store&&(o.result=Object.assign(Object.assign({},i.result),{store:Ir(i.result.store)})),n[r]=o}return JSON.stringify(n)}class lo{constructor(e,n=qn,r=zn){this._isOnline=!0,this._isShutdown=!1,this.status=ze.CONNECTING,this.queryCbs={},this.queryOnceDfds={},this.authCbs=[],this.attrsCbs=[],this.mutationErrorCbs=[],this.mutationDeferredStore=new Map,this._reconnectTimeoutId=null,this._reconnectTimeoutMs=0,this._localIdPromises={},this._errorMessage=null,this._oauthCallbackResponse=null,this._linkIndex=null,this._rooms={},this._roomsPendingLeave={},this._presence={},this._broadcastQueue=[],this._broadcastSubs={},this._currentUserCached={isLoading:!0,error:void 0,user:void 0},this._beforeUnloadCbs=[],this._dataForQueryCache={},this._onMergeQuerySubs=(i,o)=>{const s=i||{},a=Object.assign({},o);Object.entries(o).forEach(([l,d])=>{var _;const P=(_=s==null?void 0:s[l])===null||_===void 0?void 0:_.result,D=d.result;P&&!D&&(a[l].result=P)}),Object.keys(s).filter(l=>!o[l]).slice(0,10).forEach(l=>{a[l]=s[l]}),this.querySubs.set(l=>a),this.loadedNotifyAll()},this._onMergePendingMutations=(i,o)=>{const s=new Map([...i.entries(),...o.entries()]);this.pendingMutations.set(c=>s),this.loadedNotifyAll(),this._rewriteMutations(this.attrs,i).forEach((c,l)=>{!o.has(l)&&!c["tx-id"]&&this._sendMutation(l,c)})},this.getPreviousResult=i=>{const o=Te(i);return this.dataForQuery(o)},this.notifyOne=i=>{var o,s;const a=(o=this.queryCbs[i])!==null&&o!==void 0?o:[],c=(s=this._dataForQueryCache[i])===null||s===void 0?void 0:s.data,l=this.dataForQuery(i);l&&(ft(l,c)||a.forEach(d=>d.cb(l)))},this.notifyOneQueryOnce=i=>{var o;const s=(o=this.queryOnceDfds[i])!==null&&o!==void 0?o:[],a=this.dataForQuery(i);s.forEach(c=>{this._completeQueryOnce(c.q,i,c.dfd),c.dfd.resolve(a)})},this.notifyQueryError=(i,o)=>{(this.queryCbs[i]||[]).forEach(a=>a.cb({error:o}))},this.pushTx=i=>{try{const o=Ei(this.optimisticAttrs(),i);return this.pushOps(o)}catch(o){return this.pushOps([],o)}},this.pushOps=(i,o)=>{const s=pe(),a={op:"transact","tx-steps":i,error:o};this.pendingMutations.set(l=>(l.set(s,a),l));const c=new $n;return this.mutationDeferredStore.set(s,c),this._sendMutation(s,a),this.notifyAll(),c.promise},this._wsOnOpen=()=>{Ye.info("[socket] connected"),this._setStatus(ze.OPENED),this.getCurrentUser().then(i=>{var o;this._trySend(pe(),{op:"init","app-id":this.config.appId,"refresh-token":(o=i.user)===null||o===void 0?void 0:o.refresh_token,"__admin-token":this.config.__adminToken})})},this._wsOnMessage=i=>{this._handleReceive(JSON.parse(i.data.toString()))},this._wsOnError=i=>{Ye.error("[socket] error: ",i)},this._wsOnClose=()=>{this._setStatus(ze.CLOSED);for(const i of Object.values(this._rooms))i.isConnected=!1;if(this._isShutdown){Ye.info("[socket-close] socket has been shut down and will not reconnect");return}if(this._isManualClose){this._isManualClose=!1,Ye.info("[socket-close] manual close, will not reconnect");return}Ye.info("[socket-close] scheduling reconnect",this._reconnectTimeoutMs),setTimeout(()=>{if(this._reconnectTimeoutMs=Math.min(this._reconnectTimeoutMs+1e3,1e4),!this._isOnline){Ye.info("[socket-close] we are offline, no need to start socket");return}this._startSocket()},this._reconnectTimeoutMs)},this.config=Object.assign(Object.assign({},so),e),this.config.schema&&(this._linkIndex=io(this.config.schema)),ao()&&(typeof BroadcastChannel=="function"&&(this._broadcastChannel=new BroadcastChannel("@instantdb"),this._broadcastChannel.addEventListener("message",i=>le(this,void 0,void 0,function*(){var o;if(((o=i.data)===null||o===void 0?void 0:o.type)==="auth"){const s=yield this.getCurrentUser();this.updateUser(s.user)}}))),this._oauthCallbackResponse=this._oauthLoginInit(),this._initStorage(n),this.getCurrentUser(),r.getIsOnline().then(i=>{this._isOnline=i,this._startSocket(),r.listen(o=>{o!==this._isOnline&&(this._isOnline=o,this._isOnline&&this._startSocket())})}),typeof addEventListener<"u"&&(this._beforeUnload=this._beforeUnload.bind(this),addEventListener("beforeunload",this._beforeUnload)))}_initStorage(e){this._persister=new e(`instant_${this.config.appId}_5`),this.querySubs=new Yn(this._persister,"querySubs",{},this._onMergeQuerySubs,co,uo),this.pendingMutations=new Yn(this._persister,"pendingMutations",new Map,this._onMergePendingMutations,n=>JSON.stringify([...n.entries()]),n=>new Map(JSON.parse(n))),this._beforeUnloadCbs.push(()=>{this.pendingMutations.flush(),this.querySubs.flush()})}_beforeUnload(){for(const e of this._beforeUnloadCbs)e()}_finishTransaction(e,n,r){const i=this.mutationDeferredStore.get(n);this.mutationDeferredStore.delete(n);const o=e!=="error"&&e!=="timeout";!i&&!o&&console.error("Mutation failed",Object.assign({status:e,clientId:n},r)),i&&(o?i.resolve({status:e,clientId:n}):i.reject(Object.assign({status:e,clientId:n},r)))}_setStatus(e,n){this.status=e,this._errorMessage=n}_cleanPendingMutations(e){this.pendingMutations.set(n=>{const r=new Map(n);return[...n.entries()].forEach(([i,o])=>{o["tx-id"]<=e&&r.delete(i)}),r})}_flushEnqueuedRoomData(e){var n,r;const i=(r=(n=this._presence[e])===null||n===void 0?void 0:n.result)===null||r===void 0?void 0:r.user,o=this._broadcastQueue[e];if(this._broadcastQueue[e]=[],i&&this._trySetPresence(e,i),o)for(const s of o){const{topic:a,roomType:c,data:l}=s;this._tryBroadcast(e,c,a,l)}}_handleReceive(e){var n,r,i,o;const s=!!this.config.schema&&("cardinalityInference"in this.config?!!this.config.cardinalityInference:!0);switch(e.op){case"init-ok":this._setStatus(ze.AUTHENTICATED),this._reconnectTimeoutMs=0,this._setAttrs(e.attrs),this._flushPendingMessages(),this._sessionId=e["session-id"];for(const k of Object.keys(this._rooms))this._tryJoinRoom(k);break;case"add-query-exists":this.notifyOneQueryOnce(Te(e.q));break;case"add-query-ok":const{q:a,result:c,"processed-tx-id":l}=e;this._cleanPendingMutations(l);const d=Te(a),_=(r=(n=c==null?void 0:c[0])===null||n===void 0?void 0:n.data)===null||r===void 0?void 0:r["page-info"],P=(o=(i=c==null?void 0:c[0])===null||i===void 0?void 0:i.data)===null||o===void 0?void 0:o.aggregate,D=Qn(c),O=Lt(this.attrs,D,s,this._linkIndex);this.querySubs.set(k=>(k[d].result={store:O,pageInfo:_,aggregate:P},k)),this.notifyOne(d),this.notifyOneQueryOnce(d);break;case"refresh-ok":const{computations:x,attrs:w,"processed-tx-id":A}=e;this._cleanPendingMutations(A),this._setAttrs(w);const R=x.map(k=>{var Y,ee,H,Q;const be=k["instaql-query"],Ee=k["instaql-result"],Le=Te(be),Ve=Qn(Ee),We=Lt(this.attrs,Ve,s,this._linkIndex),$e=(ee=(Y=Ee==null?void 0:Ee[0])===null||Y===void 0?void 0:Y.data)===null||ee===void 0?void 0:ee["page-info"],Be=(Q=(H=Ee==null?void 0:Ee[0])===null||H===void 0?void 0:H.data)===null||Q===void 0?void 0:Q.aggregate;return{hash:Le,store:We,pageInfo:$e,aggregate:Be}});R.forEach(({hash:k,store:Y,pageInfo:ee,aggregate:H})=>{this.querySubs.set(Q=>(Q[k].result={store:Y,pageInfo:ee,aggregate:H},Q))}),R.forEach(({hash:k})=>{this.notifyOne(k)});break;case"transact-ok":const{"client-event-id":j,"tx-id":M}=e,g=this._rewriteMutations(this.attrs,this.pendingMutations.currentValue).get(j);if(!g)break;const S=Object.assign(Object.assign({},g),{"tx-id":M});this.pendingMutations.set(k=>(k.set(j,S),k)),this._finishTransaction("synced",j);const h=g["tx-steps"].filter(([k,...Y])=>k==="add-attr").map(([k,Y])=>Y).concat(Object.values(this.attrs));this._setAttrs(h);break;case"refresh-presence":const v=e["room-id"];this._setPresencePeers(v,e.data),this._notifyPresenceSubs(v);break;case"server-broadcast":const f=e["room-id"],m=e.topic;this._notifyBroadcastSubs(f,m,e);break;case"join-room-ok":const E=e["room-id"],z=this._rooms[E];if(!z){this._roomsPendingLeave[v]&&(this._tryLeaveRoom(E),delete this._roomsPendingLeave[v]);break}z.isConnected=!0,this._notifyPresenceSubs(E),this._flushEnqueuedRoomData(E);break;case"join-room-error":const F=e["room-id"],q=this._rooms[F];q&&(q.error=e.error),this._notifyPresenceSubs(F);break;case"error":this._handleReceiveError(e);break}}_handleMutationError(e,n,r){const i=this.pendingMutations.currentValue.get(n);i&&(e!=="timeout"||!i["tx-id"])&&(this.pendingMutations.set(o=>(o.delete(n),o)),this.notifyAll(),this.notifyAttrsSubs(),this.notifyMutationErrorSubs(r),this._finishTransaction(e,n,r))}_handleReceiveError(e){var n,r,i;const o=e["client-event-id"],s=this.pendingMutations.currentValue.get(o),a={message:e.message||"Uh-oh, something went wrong. Ping Joe & Stopa."};if(s){const _={message:e.message,hint:e.hint};this._handleMutationError("error",o,_);return}const c=e.q||((n=e["original-event"])===null||n===void 0?void 0:n.q);if(c){const _=Te(c);this.querySubs.set(P=>(delete P[_],P)),this.notifyQueryError(Te(c),a),this.notifyQueryOnceError(_,o,a);return}if(((r=e["original-event"])===null||r===void 0?void 0:r.op)==="init"){if(e.type==="record-not-found"&&((i=e.hint)===null||i===void 0?void 0:i["record-type"])==="app-user"){this.changeCurrentUser(null);return}this._setStatus(ze.ERRORED,a),this.notifyAll();return}const d=Object.assign({},e);delete d.message,delete d.hint,console.error(e.message,d),e.hint&&console.error(`This error comes with some debugging information. Here it is: 
`,e.hint)}notifyQueryOnceError(e,n,r){var i;const o=(i=this.queryOnceDfds[e])===null||i===void 0?void 0:i.find(s=>s.eventId===n);o&&o.dfd.reject(r)}_setAttrs(e){this.attrs=e.reduce((n,r)=>(n[r.id]=r,n),{}),this.notifyAttrsSubs()}_startQuerySub(e,n){const r=pe();return this.querySubs.set(i=>(i[n]=i[n]||{q:e,result:null,eventId:r},i)),this._trySendAuthed(r,{op:"add-query",q:e}),r}subscribeQuery(e,n){var r;const i=Te(e),o=this.getPreviousResult(e);return o&&n(o),this.queryCbs[i]=(r=this.queryCbs[i])!==null&&r!==void 0?r:[],this.queryCbs[i].push({q:e,cb:n}),this._startQuerySub(e,i),()=>{this._unsubQuery(e,i,n)}}queryOnce(e){return le(this,void 0,void 0,function*(){var n;if(!this._isOnline)throw new Error("Offline: Cannot execute query because the device is offline.");const r=Te(e),i=new $n,o=this._startQuerySub(e,r);return this.queryOnceDfds[r]=(n=this.queryOnceDfds[r])!==null&&n!==void 0?n:[],this.queryOnceDfds[r].push({q:e,dfd:i,eventId:o}),setTimeout(()=>i.reject(new Error("Query timed out")),oo),i.promise})}_completeQueryOnce(e,n,r){this.queryOnceDfds[n]&&(this.queryOnceDfds[n]=this.queryOnceDfds[n].filter(i=>i.dfd!==r),this._cleanupQuery(e,n))}_unsubQuery(e,n,r){this.queryCbs[n]&&(this.queryCbs[n]=this.queryCbs[n].filter(i=>i.cb!==r),this._cleanupQuery(e,n))}_cleanupQuery(e,n){var r,i;!((r=this.queryCbs[n])===null||r===void 0)&&r.length||!((i=this.queryOnceDfds[n])===null||i===void 0)&&i.length||(delete this.queryCbs[n],delete this.queryOnceDfds[n],this._trySendAuthed(pe(),{op:"remove-query",q:e}))}_rewriteMutations(e,n){if(!e)return n;const r=c=>{const[l,d,_]=c["forward-identity"];return ye(e,d,_)},i=c=>{const[l,d,_]=c["forward-identity"];return Ke(e,d,_)},o={attrIdMap:{},refSwapAttrIds:new Set},s=c=>{const l=[];for(const d of c){const[_]=d;if(_==="add-attr"){const[D,O]=d,x=r(O);if(x){o.attrIdMap[O.id]=x.id;continue}if(O["value-type"]==="ref"){const w=i(O);if(w){o.attrIdMap[O.id]=w.id,o.refSwapAttrIds.add(O.id);continue}}}const P=ai(o,d);l.push(P)}return l},a=new Map;for(const[c,l]of n.entries())a.set(c,Object.assign(Object.assign({},l),{"tx-steps":s(l["tx-steps"])}));return a}optimisticAttrs(){var e;const n=[...this.pendingMutations.currentValue.values()].flatMap(a=>a["tx-steps"]),r=new Set(n.filter(([a,c])=>a==="delete-attr").map(([a,c])=>c)),i=[];for(const[a,c]of n)if(a==="add-attr")i.push(c);else if(a==="update-attr"&&c.id&&(!((e=this.attrs)===null||e===void 0)&&e[c.id])){const l=Object.assign(Object.assign({},this.attrs[c.id]),c);i.push(l)}const o=[...Object.values(this.attrs||{}),...i].filter(a=>!r.has(a.id));return Object.fromEntries(o.map(a=>[a.id,a]))}dataForQuery(e){const n=this._errorMessage;if(n)return{error:n};if(!this.querySubs||!this.pendingMutations)return;const r=this.querySubs.version(),i=this.querySubs.currentValue,o=this.pendingMutations.version(),s=this.pendingMutations.currentValue,{q:a,result:c}=i[e]||{};if(!c)return;const l=this._dataForQueryCache[e];if(l&&r===l.querySubVersion&&o===l.pendingMutationsVersion)return l.data;const{store:d,pageInfo:_,aggregate:P}=c,O=[...this._rewriteMutations(d.attrs,s).values()].flatMap(A=>A["tx-steps"]),x=zr(d,O),w=Wi({store:x,pageInfo:_,aggregate:P},a);return this._dataForQueryCache[e]={querySubVersion:r,pendingMutationsVersion:o,data:w},w}notifyAll(){Object.keys(this.queryCbs).forEach(e=>{this.notifyOne(e)})}loadedNotifyAll(){this.pendingMutations.isLoading()||this.querySubs.isLoading()||this.notifyAll()}shutdown(){this._isShutdown=!0,this._ws.close()}_sendMutation(e,n){if(n.error){this._handleMutationError("error",e,{error:n.error,message:n.error.message});return}if(this.status!==ze.AUTHENTICATED){this._finishTransaction("enqueued",e);return}const r=Math.max(5e3,this.pendingMutations.currentValue.size*5e3);this._isOnline?(this._trySend(e,n),setTimeout(()=>{this._finishTransaction("pending",e)},3e3),setTimeout(()=>{this._isOnline&&this._handleMutationError("timeout",e,{message:"transaction timed out"})},r)):this._finishTransaction("enqueued",e)}_flushPendingMessages(){Object.keys(this.queryCbs).map(i=>this.querySubs.currentValue[i]).filter(i=>i).forEach(({eventId:i,q:o})=>{this._trySendAuthed(i,{op:"add-query",q:o})}),Object.values(this.queryOnceDfds).flat().forEach(({eventId:i,q:o})=>{this._trySendAuthed(i,{op:"add-query",q:o})}),this._rewriteMutations(this.attrs,this.pendingMutations.currentValue).forEach((i,o)=>{i["tx-id"]||this._sendMutation(o,i)})}_trySendAuthed(e,n){this.status===ze.AUTHENTICATED&&this._trySend(e,n)}_trySend(e,n){this._ws.readyState===Kn&&this._ws.send(JSON.stringify(Object.assign({"client-event-id":e},n)))}_ensurePreviousSocketClosed(){this._ws&&this._ws.readyState===Kn&&(this._isManualClose=!0,this._ws.close())}_startSocket(){this._ensurePreviousSocketClosed(),this._ws=new WebSocket(`${this.config.websocketURI}?app_id=${this.config.appId}`),this._ws.onopen=this._wsOnOpen,this._ws.onmessage=this._wsOnMessage,this._ws.onclose=this._wsOnClose}getLocalId(e){return le(this,void 0,void 0,function*(){const n=`localToken_${e}`,r=yield this._persister.getItem(n);if(r)return r;if(this._localIdPromises[n])return this._localIdPromises[n];const i=pe();return this._localIdPromises[n]=this._persister.setItem(n,i).then(()=>i),this._localIdPromises[n]})}_replaceUrlAfterOAuth(){if(typeof URL>"u")return;const e=new URL(window.location.href);if(e.searchParams.get(Vt)){const n=e.toString();e.searchParams.delete(Vt),e.searchParams.delete("code"),e.searchParams.delete("error");const r=e.pathname+(e.searchParams.size?"?"+e.searchParams:"")+e.hash;if(history.replaceState(history.state,"",r),typeof navigation=="object"&&typeof navigation.addEventListener=="function"&&typeof navigation.removeEventListener=="function"){let i=!1;const o=s=>{var a;i||(i=!0,navigation.removeEventListener("navigate",o),!s.userInitiated&&s.navigationType==="replace"&&((a=s.destination)===null||a===void 0?void 0:a.url)===n&&history.replaceState(history.state,"",r))};navigation.addEventListener("navigate",o)}}}_oauthLoginInit(){return le(this,void 0,void 0,function*(){var e,n,r,i;if(typeof window>"u"||typeof window.location>"u"||typeof URLSearchParams>"u")return null;const o=new URLSearchParams(window.location.search);if(!o.get(Vt))return null;const s=o.get("error");if(s)return this._replaceUrlAfterOAuth(),{error:{message:s}};const a=o.get("code");if(!a)return null;this._replaceUrlAfterOAuth();try{const{user:c}=yield Vn({apiURI:this.config.apiURI,appId:this.config.appId,code:a});return this.setCurrentUser(c),null}catch(c){return((e=c==null?void 0:c.body)===null||e===void 0?void 0:e.type)==="record-not-found"&&((r=(n=c==null?void 0:c.body)===null||n===void 0?void 0:n.hint)===null||r===void 0?void 0:r["record-type"])==="app-oauth-code"&&(yield this._hasCurrentUser())?null:{error:{message:((i=c==null?void 0:c.body)===null||i===void 0?void 0:i.message)||"Error logging in."}}}})}_waitForOAuthCallbackResponse(){return le(this,void 0,void 0,function*(){return yield this._oauthCallbackResponse})}__subscribeMutationErrors(e){return this.mutationErrorCbs.push(e),()=>{this.mutationErrorCbs=this.mutationErrorCbs.filter(n=>n!==e)}}subscribeAuth(e){this.authCbs.push(e);const n=this._currentUserCached;n.isLoading||e(this._currentUserCached);let r=!1;return this.getCurrentUser().then(i=>{r||ft(i,n)||e(i)}),()=>{r=!0,this.authCbs=this.authCbs.filter(i=>i!==e)}}subscribeAttrs(e){return this.attrsCbs.push(e),this.attrs&&e(this.attrs),()=>{this.attrsCbs=this.attrsCbs.filter(n=>n!==e)}}notifyAuthSubs(e){this.authCbs.forEach(n=>n(e))}notifyMutationErrorSubs(e){this.mutationErrorCbs.forEach(n=>n(e))}notifyAttrsSubs(){if(!this.attrs)return;const e=this.optimisticAttrs();this.attrsCbs.forEach(n=>n(e))}setCurrentUser(e){return le(this,void 0,void 0,function*(){yield this._persister.setItem(Wt,JSON.stringify(e))})}getCurrentUserCached(){return this._currentUserCached}getCurrentUser(){return le(this,void 0,void 0,function*(){const e=yield this._waitForOAuthCallbackResponse();if(e!=null&&e.error){const i={error:e.error,user:void 0};return this._currentUserCached=Object.assign({isLoading:!1},i),i}const n=yield this._persister.getItem(Wt),r={user:JSON.parse(n),error:void 0};return this._currentUserCached=Object.assign({isLoading:!1},r),r})}_hasCurrentUser(){return le(this,void 0,void 0,function*(){const e=yield this._persister.getItem(Wt);return JSON.parse(e)!=null})}changeCurrentUser(e){return le(this,void 0,void 0,function*(){var n;const{user:r}=yield this.getCurrentUser();if(!ft(r,e)){yield this.setCurrentUser(e),this.updateUser(e);try{(n=this._broadcastChannel)===null||n===void 0||n.postMessage({type:"auth"})}catch(i){console.error("Error posting message to broadcast channel",i)}}})}updateUser(e){const n={error:void 0,user:e};this._currentUserCached=Object.assign({isLoading:!1},n),this.querySubs.set(r=>(Object.keys(r).forEach(i=>{delete r[i].result}),r)),this._reconnectTimeoutMs=0,this._ws.close(),this._oauthCallbackResponse=null,this.notifyAuthSubs(n)}sendMagicCode({email:e}){return Ji({apiURI:this.config.apiURI,appId:this.config.appId,email:e})}signInWithMagicCode(e){return le(this,arguments,void 0,function*({email:n,code:r}){const i=yield Qi({apiURI:this.config.apiURI,appId:this.config.appId,email:n,code:r});return this.changeCurrentUser(i.user),i})}signInWithCustomToken(e){return le(this,void 0,void 0,function*(){const n=yield Ki({apiURI:this.config.apiURI,appId:this.config.appId,refreshToken:e});this.changeCurrentUser(n.user)})}signOut(){return le(this,void 0,void 0,function*(){var e;const n=yield this.getCurrentUser(),r=(e=n==null?void 0:n.user)===null||e===void 0?void 0:e.refresh_token;if(r)try{yield Gi({apiURI:this.config.apiURI,appId:this.config.appId,refreshToken:r})}catch{}this.changeCurrentUser(null)})}createAuthorizationURL({clientName:e,redirectURL:n}){const{apiURI:r,appId:i}=this.config;return`${r}/runtime/oauth/start?app_id=${i}&client_name=${e}&redirect_uri=${n}`}exchangeCodeForToken(e){return le(this,arguments,void 0,function*({code:n,codeVerifier:r}){const i=yield Vn({apiURI:this.config.apiURI,appId:this.config.appId,code:n,codeVerifier:r});return this.changeCurrentUser(i.user),i})}issuerURI(){const{apiURI:e,appId:n}=this.config;return`${e}/runtime/${n}`}signInWithIdToken(e){return le(this,arguments,void 0,function*({idToken:n,clientName:r,nonce:i}){var o;const s=yield this.getCurrentUser(),a=(o=s==null?void 0:s.user)===null||o===void 0?void 0:o.refresh_token,c=yield Hi({apiURI:this.config.apiURI,appId:this.config.appId,idToken:n,clientName:r,nonce:i,refreshToken:a});return this.changeCurrentUser(c.user),c})}joinRoom(e){return this._rooms[e]||(this._rooms[e]={isConnected:!1,error:void 0}),this._tryJoinRoom(e),()=>{this._cleanupRoom(e)}}_cleanupRoom(e){var n,r,i,o;if(!(!((r=(n=this._presence[e])===null||n===void 0?void 0:n.handlers)===null||r===void 0)&&r.length)&&!Object.keys((i=this._broadcastSubs[e])!==null&&i!==void 0?i:{}).length){const s=(o=this._rooms[e])===null||o===void 0?void 0:o.isConnected;delete this._rooms[e],delete this._presence[e],delete this._broadcastSubs[e],s?this._tryLeaveRoom(e):this._roomsPendingLeave[e]=!0}}getPresence(e,n,r={}){const i=this._rooms[n],o=this._presence[n];return!i||!o||!o.result?null:Object.assign(Object.assign({},no(o.result,r,this._sessionId)),{isLoading:!i.isConnected,error:i.error})}publishPresence(e,n,r){const i=this._rooms[n],o=this._presence[n];if(!i||!o)return;o.result=o.result||{};const s=Object.assign(Object.assign({},o.result.user),r);o.result.user=s,i.isConnected&&(this._trySetPresence(n,s),this._notifyPresenceSubs(n))}_trySetPresence(e,n){this._trySendAuthed(pe(),{op:"set-presence","room-id":e,data:n})}_tryJoinRoom(e){this._trySendAuthed(pe(),{op:"join-room","room-id":e}),delete this._roomsPendingLeave[e]}_tryLeaveRoom(e){this._trySendAuthed(pe(),{op:"leave-room","room-id":e})}subscribePresence(e,n,r,i){const o=this.joinRoom(n),s=Object.assign(Object.assign({},r),{roomId:n,cb:i,prev:null});return this._presence[n]=this._presence[n]||{},this._presence[n].handlers=this._presence[n].handlers||[],this._presence[n].handlers.push(s),this._notifyPresenceSub(n,s),()=>{var a,c,l;this._presence[n].handlers=(l=(c=(a=this._presence[n])===null||a===void 0?void 0:a.handlers)===null||c===void 0?void 0:c.filter(d=>d!==s))!==null&&l!==void 0?l:[],o()}}_notifyPresenceSubs(e){var n,r;(r=(n=this._presence[e])===null||n===void 0?void 0:n.handlers)===null||r===void 0||r.forEach(i=>{this._notifyPresenceSub(e,i)})}_notifyPresenceSub(e,n){const r=this.getPresence("",e,n);r&&(n.prev&&!ro(r,n.prev)||(n.prev=r,n.cb(r)))}_setPresencePeers(e,n){const r=Object.assign({},n);delete r[this._sessionId];const i=Object.fromEntries(Object.entries(r).map(([o,s])=>[o,s.data]));this._presence[e]=this._presence[e]||{},this._presence[e].result=this._presence[e].result||{},this._presence[e].result.peers=i}publishTopic({roomType:e,roomId:n,topic:r,data:i}){var o;const s=this._rooms[n];if(s){if(!s.isConnected){this._broadcastQueue[n]=(o=this._broadcastQueue[n])!==null&&o!==void 0?o:[],this._broadcastQueue[n].push({topic:r,roomType:e,data:i});return}this._tryBroadcast(n,e,r,i)}}_tryBroadcast(e,n,r,i){this._trySendAuthed(pe(),{op:"client-broadcast","room-id":e,roomType:n,topic:r,data:i})}subscribeTopic(e,n,r){const i=this.joinRoom(e);return this._broadcastSubs[e]=this._broadcastSubs[e]||{},this._broadcastSubs[e][n]=this._broadcastSubs[e][n]||[],this._broadcastSubs[e][n].push(r),this._presence[e]=this._presence[e]||{},()=>{this._broadcastSubs[e][n]=this._broadcastSubs[e][n].filter(o=>o!==r),this._broadcastSubs[e][n].length||delete this._broadcastSubs[e][n],i()}}_notifyBroadcastSubs(e,n,r){var i,o,s;(s=(o=(i=this._broadcastSubs)===null||i===void 0?void 0:i[e])===null||o===void 0?void 0:o[n])===null||s===void 0||s.forEach(a=>{var c,l,d,_,P,D;const O=(c=r.data)===null||c===void 0?void 0:c.data,x=r.data["peer-id"]===this._sessionId?(d=(l=this._presence[e])===null||l===void 0?void 0:l.result)===null||d===void 0?void 0:d.user:(D=(P=(_=this._presence[e])===null||_===void 0?void 0:_.result)===null||P===void 0?void 0:P.peers)===null||D===void 0?void 0:D[r.data["peer-id"]];return a(O,x)})}upload(e,n){return le(this,void 0,void 0,function*(){var r;const i=yield this.getCurrentUser(),o=(r=i==null?void 0:i.user)===null||r===void 0?void 0:r.refresh_token,s=e||n.name,a=yield Xi({apiURI:this.config.apiURI,appId:this.config.appId,fileName:s,refreshToken:o});return yield Zi(a,n)})}getDownloadUrl(e){return le(this,void 0,void 0,function*(){var n;const r=yield this.getCurrentUser(),i=(n=r==null?void 0:r.user)===null||n===void 0?void 0:n.refresh_token;return yield eo({apiURI:this.config.apiURI,appId:this.config.appId,path:e,refreshToken:i})})}deleteFile(e){return le(this,void 0,void 0,function*(){var n;const r=yield this.getCurrentUser(),i=(n=r==null?void 0:r.user)===null||n===void 0?void 0:n.refresh_token;return yield to({apiURI:this.config.apiURI,appId:this.config.appId,path:e,refreshToken:i})})}}class Ue{constructor(e,n,r={indexed:!1,unique:!1}){this.valueType=e,this.required=n,this.config=r}optional(){return new Ue(this.valueType,!1)}unique(){return new Ue(this.valueType,this.required,Object.assign(Object.assign({},this.config),{unique:!0}))}indexed(){return new Ue(this.valueType,this.required,Object.assign(Object.assign({},this.config),{indexed:!0}))}}class $t{constructor(e,n){this.entities=e,this.links=n}withRoomSchema(){return new $t(this.entities,this.links)}}class _t{constructor(e,n){this.attrs=e,this.links=n}asType(){return new _t(this.attrs,this.links)}}function fo(t,e){return new $t(_o(t,e),e)}function ho(t){return new _t(t,{})}function po(){return new Ue("string",!0)}function yo(){return new Ue("number",!0)}function vo(){return new Ue("boolean",!0)}function bo(){return new Ue("json",!0)}function go(){return new Ue("json",!0)}function _o(t,e){var n,r,i,o;const s={fwd:{},rev:{}};for(const c of Object.values(e))(n=s.fwd)[r=c.forward.on]||(n[r]={}),(i=s.rev)[o=c.reverse.on]||(i[o]={}),s.fwd[c.forward.on][c.forward.label]={entityName:c.reverse.on,cardinality:c.forward.has},s.rev[c.reverse.on][c.reverse.label]={entityName:c.forward.on,cardinality:c.reverse.has};return Object.fromEntries(Object.entries(t).map(([c,l])=>[c,new _t(l.attrs,Object.assign(Object.assign({},s.fwd[c]),s.rev[c]))]))}const mo={graph:fo,entity:ho,string:po,number:yo,boolean:vo,json:bo,any:go};let mt;function wo(t){mt==null||mt.dispose();const e=jo(),n=Oo(s),r=So(Eo(t));function i(l){var d;l.source===r.element.contentWindow&&((d=l.data)===null||d===void 0?void 0:d.type)==="close"&&e.isVisible()&&s()}function o(l){const d=l.shiftKey&&l.ctrlKey&&l.key==="0",_=l.key==="Escape"||l.key==="Esc";(d||_)&&s()}function s(){e.isVisible()?e.element.style.display="none":(e.element.style.display="block",e.element.contains(r.element)||e.element.appendChild(r.element))}function a(){e.element.remove(),n.element.remove(),removeEventListener("keydown",o),removeEventListener("message",i)}function c(){document.body.appendChild(e.element),document.body.appendChild(n.element),addEventListener("keydown",o),addEventListener("message",i),mt={dispose:a}}return c()}function Eo(t){return`${window.DEV_DEVTOOL?"http://localhost:3000":"https://instantdb.com"}/_devtool?appId=${t}`}function So(t){const e=document.createElement("iframe");return e.src=t,Object.assign(e.style,{width:"100%",height:"100%",borderRadius:"4px",backgroundColor:"white",border:"none"}),{element:e}}function Oo(t){const e=`
    <svg width="32" height="32" viewBox="0 0 512 512" fill="none" xmlns="http://www.w3.org/2000/svg">
      <rect width="512" height="512" fill="black"/>
      <rect x="97.0973" y="91.3297" width="140" height="330" fill="white"/>
    </svg>
  `,n=document.createElement("button");return n.innerHTML=e,Object.assign(n.style,{position:"fixed",bottom:"24px",left:"24px",height:"32px",width:"32px",display:"flex",alignItems:"center",justifyContent:"center",padding:"0",margin:"0",border:"none",cursor:"pointer"}),n.addEventListener("click",t),{element:n}}function jo(){const t=document.createElement("div");Object.assign(t.style,{position:"fixed",bottom:"24px",right:"24px",left:"60px",top:"72px",display:"block",borderRadius:"4px",border:"1px #ccc solid",boxShadow:"0px 0px 8px #00000044",backgroundColor:"#eee",zIndex:"999990"}),t.style.display="none";function e(){return t.style.display!=="none"}return{element:t,isVisible:e}}const Ao=!0,Ro={apiURI:"https://api.instantdb.com",websocketURI:"wss://api.instantdb.com/runtime/session"};function xo(){var t;return globalThis.__instantDbStore=(t=globalThis.__instantDbStore)!==null&&t!==void 0?t:{},globalThis.__instantDbStore}const Yt=xo();function Io(t,e,n){const r=Yt[t.appId];if(r)return r;const i=new lo(Object.assign(Object.assign({},Ro),t),e||qn,n||zn),o=new Co(i);return Yt[t.appId]=o,typeof window<"u"&&typeof window.location<"u"&&("devtool"in t?t.devtool:Ao)&&window.location.hostname==="localhost"&&!globalThis._nodevtool&&wo(t.appId),o}class Co{constructor(e){this.tx=qt(),this._reactor=e,this.auth=new To(this._reactor),this.storage=new Mo(this._reactor)}transact(e){return this._reactor.pushTx(e)}getLocalId(e){return this._reactor.getLocalId(e)}subscribeQuery(e,n){return this._reactor.subscribeQuery(e,n)}subscribeAuth(e){return this._reactor.subscribeAuth(e)}joinRoom(e="_defaultRoomType",n="_defaultRoomId"){return{leaveRoom:this._reactor.joinRoom(n),subscribeTopic:(i,o)=>this._reactor.subscribeTopic(n,i,o),subscribePresence:(i,o)=>this._reactor.subscribePresence(e,n,i,o),publishTopic:(i,o)=>this._reactor.publishTopic({roomType:e,roomId:n,topic:i,data:o}),publishPresence:i=>this._reactor.publishPresence(e,n,i),getPresence:i=>this._reactor.getPresence(e,n,i)}}shutdown(){delete Yt[this._reactor.config.appId],this._reactor.shutdown()}queryOnce(e){return this._reactor.queryOnce(e)}}class To{constructor(e){this.db=e,this.sendMagicCode=n=>this.db.sendMagicCode(n),this.signInWithMagicCode=n=>this.db.signInWithMagicCode(n),this.signInWithToken=n=>this.db.signInWithCustomToken(n),this.createAuthorizationURL=n=>this.db.createAuthorizationURL(n),this.signInWithIdToken=n=>this.db.signInWithIdToken(n),this.exchangeOAuthCode=n=>this.db.exchangeCodeForToken(n),this.issuerURI=()=>this.db.issuerURI(),this.signOut=()=>this.db.signOut()}}class Mo{constructor(e){this.db=e,this.upload=(n,r)=>this.db.upload(n,r),this.put=this.upload,this.getDownloadUrl=n=>this.db.getDownloadUrl(n),this.delete=n=>this.db.deleteFile(n)}}function Po(t){return JSON.parse(JSON.stringify(t))}const ko={isLoading:!0,data:void 0,pageInfo:void 0,error:void 0};function Uo(t){return{isLoading:!t,data:void 0,pageInfo:void 0,error:void 0,...t||{}}}function Lo(t,e){const n=e?Po(e):null,r=Te(n),i=te.useRef(Uo(t._reactor.getPreviousResult(n))),o=te.useCallback(a=>n?t.subscribeQuery(n,l=>{i.current={isLoading:!l,data:void 0,pageInfo:void 0,error:void 0,...l},a()}):()=>{},[r]);return{state:te.useSyncExternalStore(o,()=>i.current,()=>ko),query:n}}function Do(){const t=te.useRef(null);te.useEffect(()=>{n()},[]);function e(r,i){clearTimeout(t.current),t.current=setTimeout(i,r)}function n(){clearTimeout(t.current)}return{set:e,clear:n}}const Bo=1e3;class No{constructor(e,n,r){this.useTopicEffect=(i,o)=>{te.useEffect(()=>this._core._reactor.subscribeTopic(this.id,i,(a,c)=>{o(a,c)}),[this.id,i])},this.usePublishTopic=i=>(te.useEffect(()=>this._core._reactor.joinRoom(this.id),[this.id]),te.useCallback(s=>{this._core._reactor.publishTopic({roomType:this.type,roomId:this.id,topic:i,data:s})},[this.id,i])),this.usePresence=(i={})=>{var a,c;const[o,s]=te.useState(()=>this._core._reactor.getPresence(this.type,this.id,i)??{peers:{},isLoading:!0});return te.useEffect(()=>this._core._reactor.subscribePresence(this.type,this.id,i,d=>{s(d)}),[this.id,i.user,(a=i.peers)==null?void 0:a.join(),(c=i.keys)==null?void 0:c.join()]),{...o,publishPresence:l=>{this._core._reactor.publishPresence(this.type,this.id,l)}}},this.useSyncPresence=(i,o)=>{te.useEffect(()=>this._core._reactor.joinRoom(this.id),[this.id]),te.useEffect(()=>this._core._reactor.publishPresence(this.type,this.id,i),[this.type,this.id,o??JSON.stringify(i)])},this.useTypingIndicator=(i,o={})=>{const s=Do(),a=this.usePresence({keys:[i]}),c=te.useMemo(()=>{const d=this._core._reactor.getPresence(this.type,this.id);return o!=null&&o.writeOnly?[]:Object.values((d==null?void 0:d.peers)??{}).filter(_=>_[i]===!0)},[o==null?void 0:o.writeOnly,a]),l=d=>{this._core._reactor.publishPresence(this.type,this.id,{[i]:d}),d&&((o==null?void 0:o.timeout)===null||(o==null?void 0:o.timeout)===0||s.set((o==null?void 0:o.timeout)??Bo,()=>{this._core._reactor.publishPresence(this.type,this.id,{[i]:null})}))};return{active:c,setActive:d=>{l(d)},inputProps:{onKeyDown:d=>{const P=!((o==null?void 0:o.stopOnEnter)&&d.key==="Enter");l(P)},onBlur:()=>{l(!1)}}}},this._core=e,this.type=n,this.id=r}}const Fo={isLoading:!0,user:void 0,error:void 0};class Hn{constructor(e){this.tx=qt(),this.getLocalId=n=>this._core.getLocalId(n),this.transact=n=>this._core.transact(n),this.useQuery=n=>Lo(this._core,n).state,this.useAuth=()=>{const n=te.useRef(this._core._reactor._currentUserCached),r=te.useCallback(o=>this._core.subscribeAuth(a=>{n.current={isLoading:!1,...a},o()}),[]);return te.useSyncExternalStore(r,()=>n.current,()=>Fo)},this.queryOnce=n=>this._core.queryOnce(n),this._core=Io(e,this.constructor.Storage,this.constructor.NetworkListener),this.auth=this._core.auth,this.storage=this._core.storage}room(e="_defaultRoomType",n="_defaultRoomId"){return new No(this._core,e,n)}}class Jt extends Hn{}function qo(t){return new Jt(t)}function zo(t){return new Jt(t)}var Qt={exports:{}},rt={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Gn;function Vo(){if(Gn)return rt;Gn=1;var t=te,e=Symbol.for("react.element"),n=Symbol.for("react.fragment"),r=Object.prototype.hasOwnProperty,i=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,o={key:!0,ref:!0,__self:!0,__source:!0};function s(a,c,l){var d,_={},P=null,D=null;l!==void 0&&(P=""+l),c.key!==void 0&&(P=""+c.key),c.ref!==void 0&&(D=c.ref);for(d in c)r.call(c,d)&&!o.hasOwnProperty(d)&&(_[d]=c[d]);if(a&&a.defaultProps)for(d in c=a.defaultProps,c)_[d]===void 0&&(_[d]=c[d]);return{$$typeof:e,type:a,key:P,ref:D,props:_,_owner:i.current}}return rt.Fragment=n,rt.jsx=s,rt.jsxs=s,rt}var it={},Xn;function Wo(){if(Xn)return it;Xn=1;var t={};/**
 * @license React
 * react-jsx-runtime.development.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */return t.NODE_ENV!=="production"&&function(){var e=te,n=Symbol.for("react.element"),r=Symbol.for("react.portal"),i=Symbol.for("react.fragment"),o=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),a=Symbol.for("react.provider"),c=Symbol.for("react.context"),l=Symbol.for("react.forward_ref"),d=Symbol.for("react.suspense"),_=Symbol.for("react.suspense_list"),P=Symbol.for("react.memo"),D=Symbol.for("react.lazy"),O=Symbol.for("react.offscreen"),x=Symbol.iterator,w="@@iterator";function A(y){if(y===null||typeof y!="object")return null;var C=x&&y[x]||y[w];return typeof C=="function"?C:null}var R=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;function j(y){{for(var C=arguments.length,N=new Array(C>1?C-1:0),V=1;V<C;V++)N[V-1]=arguments[V];M("error",y,N)}}function M(y,C,N){{var V=R.ReactDebugCurrentFrame,G=V.getStackAddendum();G!==""&&(C+="%s",N=N.concat([G]));var Z=N.map(function(K){return String(K)});Z.unshift("Warning: "+C),Function.prototype.apply.call(console[y],console,Z)}}var U=!1,g=!1,S=!1,h=!1,v=!1,f;f=Symbol.for("react.module.reference");function m(y){return!!(typeof y=="string"||typeof y=="function"||y===i||y===s||v||y===o||y===d||y===_||h||y===O||U||g||S||typeof y=="object"&&y!==null&&(y.$$typeof===D||y.$$typeof===P||y.$$typeof===a||y.$$typeof===c||y.$$typeof===l||y.$$typeof===f||y.getModuleId!==void 0))}function E(y,C,N){var V=y.displayName;if(V)return V;var G=C.displayName||C.name||"";return G!==""?N+"("+G+")":N}function z(y){return y.displayName||"Context"}function F(y){if(y==null)return null;if(typeof y.tag=="number"&&j("Received an unexpected object in getComponentNameFromType(). This is likely a bug in React. Please file an issue."),typeof y=="function")return y.displayName||y.name||null;if(typeof y=="string")return y;switch(y){case i:return"Fragment";case r:return"Portal";case s:return"Profiler";case o:return"StrictMode";case d:return"Suspense";case _:return"SuspenseList"}if(typeof y=="object")switch(y.$$typeof){case c:var C=y;return z(C)+".Consumer";case a:var N=y;return z(N._context)+".Provider";case l:return E(y,y.render,"ForwardRef");case P:var V=y.displayName||null;return V!==null?V:F(y.type)||"Memo";case D:{var G=y,Z=G._payload,K=G._init;try{return F(K(Z))}catch{return null}}}return null}var q=Object.assign,k=0,Y,ee,H,Q,be,Ee,Le;function Ve(){}Ve.__reactDisabledLog=!0;function We(){{if(k===0){Y=console.log,ee=console.info,H=console.warn,Q=console.error,be=console.group,Ee=console.groupCollapsed,Le=console.groupEnd;var y={configurable:!0,enumerable:!0,value:Ve,writable:!0};Object.defineProperties(console,{info:y,log:y,warn:y,error:y,group:y,groupCollapsed:y,groupEnd:y})}k++}}function $e(){{if(k--,k===0){var y={configurable:!0,enumerable:!0,writable:!0};Object.defineProperties(console,{log:q({},y,{value:Y}),info:q({},y,{value:ee}),warn:q({},y,{value:H}),error:q({},y,{value:Q}),group:q({},y,{value:be}),groupCollapsed:q({},y,{value:Ee}),groupEnd:q({},y,{value:Le})})}k<0&&j("disabledDepth fell below zero. This is a bug in React. Please file an issue.")}}var Be=R.ReactCurrentDispatcher,L;function u(y,C,N){{if(L===void 0)try{throw Error()}catch(G){var V=G.stack.trim().match(/\n( *(at )?)/);L=V&&V[1]||""}return`
`+L+y}}var p=!1,b;{var T=typeof WeakMap=="function"?WeakMap:Map;b=new T}function I(y,C){if(!y||p)return"";{var N=b.get(y);if(N!==void 0)return N}var V;p=!0;var G=Error.prepareStackTrace;Error.prepareStackTrace=void 0;var Z;Z=Be.current,Be.current=null,We();try{if(C){var K=function(){throw Error()};if(Object.defineProperty(K.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(K,[])}catch(De){V=De}Reflect.construct(y,[],K)}else{try{K.call()}catch(De){V=De}y.call(K.prototype)}}else{try{throw Error()}catch(De){V=De}y()}}catch(De){if(De&&V&&typeof De.stack=="string"){for(var J=De.stack.split(`
`),ve=V.stack.split(`
`),oe=J.length-1,ae=ve.length-1;oe>=1&&ae>=0&&J[oe]!==ve[ae];)ae--;for(;oe>=1&&ae>=0;oe--,ae--)if(J[oe]!==ve[ae]){if(oe!==1||ae!==1)do if(oe--,ae--,ae<0||J[oe]!==ve[ae]){var Oe=`
`+J[oe].replace(" at new "," at ");return y.displayName&&Oe.includes("<anonymous>")&&(Oe=Oe.replace("<anonymous>",y.displayName)),typeof y=="function"&&b.set(y,Oe),Oe}while(oe>=1&&ae>=0);break}}}finally{p=!1,Be.current=Z,$e(),Error.prepareStackTrace=G}var Ge=y?y.displayName||y.name:"",lr=Ge?u(Ge):"";return typeof y=="function"&&b.set(y,lr),lr}function B(y,C,N){return I(y,!1)}function W(y){var C=y.prototype;return!!(C&&C.isReactComponent)}function X(y,C,N){if(y==null)return"";if(typeof y=="function")return I(y,W(y));if(typeof y=="string")return u(y);switch(y){case d:return u("Suspense");case _:return u("SuspenseList")}if(typeof y=="object")switch(y.$$typeof){case l:return B(y.render);case P:return X(y.type,C,N);case D:{var V=y,G=V._payload,Z=V._init;try{return X(Z(G),C,N)}catch{}}}return""}var ne=Object.prototype.hasOwnProperty,ge={},fe=R.ReactDebugCurrentFrame;function ue(y){if(y){var C=y._owner,N=X(y.type,y._source,C?C.type:null);fe.setExtraStackFrame(N)}else fe.setExtraStackFrame(null)}function se(y,C,N,V,G){{var Z=Function.call.bind(ne);for(var K in y)if(Z(y,K)){var J=void 0;try{if(typeof y[K]!="function"){var ve=Error((V||"React class")+": "+N+" type `"+K+"` is invalid; it must be a function, usually from the `prop-types` package, but received `"+typeof y[K]+"`.This often happens because of typos such as `PropTypes.function` instead of `PropTypes.func`.");throw ve.name="Invariant Violation",ve}J=y[K](C,K,V,N,null,"SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED")}catch(oe){J=oe}J&&!(J instanceof Error)&&(ue(G),j("%s: type specification of %s `%s` is invalid; the type checker function must return `null` or an `Error` but returned a %s. You may have forgotten to pass an argument to the type checker creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and shape all require an argument).",V||"React class",N,K,typeof J),ue(null)),J instanceof Error&&!(J.message in ge)&&(ge[J.message]=!0,ue(G),j("Failed %s type: %s",N,J.message),ue(null))}}}var re=Array.isArray;function Ce(y){return re(y)}function wt(y){{var C=typeof Symbol=="function"&&Symbol.toStringTag,N=C&&y[Symbol.toStringTag]||y.constructor.name||"Object";return N}}function Ho(y){try{return er(y),!1}catch{return!0}}function er(y){return""+y}function tr(y){if(Ho(y))return j("The provided key is an unsupported type %s. This value must be coerced to a string before before using it here.",wt(y)),er(y)}var ot=R.ReactCurrentOwner,Go={key:!0,ref:!0,__self:!0,__source:!0},nr,rr,Kt;Kt={};function Xo(y){if(ne.call(y,"ref")){var C=Object.getOwnPropertyDescriptor(y,"ref").get;if(C&&C.isReactWarning)return!1}return y.ref!==void 0}function Zo(y){if(ne.call(y,"key")){var C=Object.getOwnPropertyDescriptor(y,"key").get;if(C&&C.isReactWarning)return!1}return y.key!==void 0}function es(y,C){if(typeof y.ref=="string"&&ot.current&&C&&ot.current.stateNode!==C){var N=F(ot.current.type);Kt[N]||(j('Component "%s" contains the string ref "%s". Support for string refs will be removed in a future major release. This case cannot be automatically converted to an arrow function. We ask you to manually fix this case by using useRef() or createRef() instead. Learn more about using refs safely here: https://reactjs.org/link/strict-mode-string-ref',F(ot.current.type),y.ref),Kt[N]=!0)}}function ts(y,C){{var N=function(){nr||(nr=!0,j("%s: `key` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)",C))};N.isReactWarning=!0,Object.defineProperty(y,"key",{get:N,configurable:!0})}}function ns(y,C){{var N=function(){rr||(rr=!0,j("%s: `ref` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)",C))};N.isReactWarning=!0,Object.defineProperty(y,"ref",{get:N,configurable:!0})}}var rs=function(y,C,N,V,G,Z,K){var J={$$typeof:n,type:y,key:C,ref:N,props:K,_owner:Z};return J._store={},Object.defineProperty(J._store,"validated",{configurable:!1,enumerable:!1,writable:!0,value:!1}),Object.defineProperty(J,"_self",{configurable:!1,enumerable:!1,writable:!1,value:V}),Object.defineProperty(J,"_source",{configurable:!1,enumerable:!1,writable:!1,value:G}),Object.freeze&&(Object.freeze(J.props),Object.freeze(J)),J};function is(y,C,N,V,G){{var Z,K={},J=null,ve=null;N!==void 0&&(tr(N),J=""+N),Zo(C)&&(tr(C.key),J=""+C.key),Xo(C)&&(ve=C.ref,es(C,G));for(Z in C)ne.call(C,Z)&&!Go.hasOwnProperty(Z)&&(K[Z]=C[Z]);if(y&&y.defaultProps){var oe=y.defaultProps;for(Z in oe)K[Z]===void 0&&(K[Z]=oe[Z])}if(J||ve){var ae=typeof y=="function"?y.displayName||y.name||"Unknown":y;J&&ts(K,ae),ve&&ns(K,ae)}return rs(y,J,ve,G,V,ot.current,K)}}var Ht=R.ReactCurrentOwner,ir=R.ReactDebugCurrentFrame;function He(y){if(y){var C=y._owner,N=X(y.type,y._source,C?C.type:null);ir.setExtraStackFrame(N)}else ir.setExtraStackFrame(null)}var Gt;Gt=!1;function Xt(y){return typeof y=="object"&&y!==null&&y.$$typeof===n}function or(){{if(Ht.current){var y=F(Ht.current.type);if(y)return`

Check the render method of \``+y+"`."}return""}}function os(y){return""}var sr={};function ss(y){{var C=or();if(!C){var N=typeof y=="string"?y:y.displayName||y.name;N&&(C=`

Check the top-level render call using <`+N+">.")}return C}}function ar(y,C){{if(!y._store||y._store.validated||y.key!=null)return;y._store.validated=!0;var N=ss(C);if(sr[N])return;sr[N]=!0;var V="";y&&y._owner&&y._owner!==Ht.current&&(V=" It was passed a child from "+F(y._owner.type)+"."),He(y),j('Each child in a list should have a unique "key" prop.%s%s See https://reactjs.org/link/warning-keys for more information.',N,V),He(null)}}function ur(y,C){{if(typeof y!="object")return;if(Ce(y))for(var N=0;N<y.length;N++){var V=y[N];Xt(V)&&ar(V,C)}else if(Xt(y))y._store&&(y._store.validated=!0);else if(y){var G=A(y);if(typeof G=="function"&&G!==y.entries)for(var Z=G.call(y),K;!(K=Z.next()).done;)Xt(K.value)&&ar(K.value,C)}}}function as(y){{var C=y.type;if(C==null||typeof C=="string")return;var N;if(typeof C=="function")N=C.propTypes;else if(typeof C=="object"&&(C.$$typeof===l||C.$$typeof===P))N=C.propTypes;else return;if(N){var V=F(C);se(N,y.props,"prop",V,y)}else if(C.PropTypes!==void 0&&!Gt){Gt=!0;var G=F(C);j("Component %s declared `PropTypes` instead of `propTypes`. Did you misspell the property assignment?",G||"Unknown")}typeof C.getDefaultProps=="function"&&!C.getDefaultProps.isReactClassApproved&&j("getDefaultProps is only used on classic React.createClass definitions. Use a static property named `defaultProps` instead.")}}function us(y){{for(var C=Object.keys(y.props),N=0;N<C.length;N++){var V=C[N];if(V!=="children"&&V!=="key"){He(y),j("Invalid prop `%s` supplied to `React.Fragment`. React.Fragment can only have `key` and `children` props.",V),He(null);break}}y.ref!==null&&(He(y),j("Invalid attribute `ref` supplied to `React.Fragment`."),He(null))}}function cr(y,C,N,V,G,Z){{var K=m(y);if(!K){var J="";(y===void 0||typeof y=="object"&&y!==null&&Object.keys(y).length===0)&&(J+=" You likely forgot to export your component from the file it's defined in, or you might have mixed up default and named imports.");var ve=os();ve?J+=ve:J+=or();var oe;y===null?oe="null":Ce(y)?oe="array":y!==void 0&&y.$$typeof===n?(oe="<"+(F(y.type)||"Unknown")+" />",J=" Did you accidentally export a JSX literal instead of a component?"):oe=typeof y,j("React.jsx: type is invalid -- expected a string (for built-in components) or a class/function (for composite components) but got: %s.%s",oe,J)}var ae=is(y,C,N,G,Z);if(ae==null)return ae;if(K){var Oe=C.children;if(Oe!==void 0)if(V)if(Ce(Oe)){for(var Ge=0;Ge<Oe.length;Ge++)ur(Oe[Ge],y);Object.freeze&&Object.freeze(Oe)}else j("React.jsx: Static children should always be an array. You are likely explicitly calling React.jsxs or React.jsxDEV. Use the Babel transform instead.");else ur(Oe,y)}return y===i?us(ae):as(ae),ae}}function cs(y,C,N){return cr(y,C,N,!0)}function ls(y,C,N){return cr(y,C,N,!1)}var fs=ls,ds=cs;it.Fragment=i,it.jsx=fs,it.jsxs=ds}(),it}var $o={};$o.NODE_ENV==="production"?Qt.exports=Vo():Qt.exports=Wo();var we=Qt.exports;function Yo({as:t="div",spaceId:e,room:n,className:r,style:i,userCursorColor:o,children:s,renderCursor:a,propagate:c,zIndex:l}){const d=e||`cursors-space-default--${String(n.type)}-${n.id}`,_=n.usePresence({keys:[d]}),P=n._core._reactor.getPresence(n.type,n.id);function D(x){c||x.stopPropagation();const w=x.currentTarget.getBoundingClientRect(),A=x.clientX,R=x.clientY,j=(A-w.left)/w.width*100,M=(R-w.top)/w.height*100;_.publishPresence({[d]:{x:A,y:R,xPercent:j,yPercent:M,color:o}})}function O(x){_.publishPresence({[d]:void 0})}return te.createElement(t,{onMouseMove:D,onMouseOut:O,className:r,style:{position:"relative",...i}},[s,we.jsx("div",{style:{...Zn,...Qo,zIndex:l!==void 0?l:Ko},children:Object.entries(_.peers).map(([x,w])=>{const A=w[d];return A?we.jsx("div",{style:{...Zn,transform:`translate(${A.xPercent}%, ${A.yPercent}%)`,transformOrigin:"0 0",transition:"transform 100ms"},children:a?a({color:A.color,presence:P.peers[x]}):we.jsx(Jo,{...A})},x):null})},d)])}function Jo({color:t}){const n=t||"black";return we.jsxs("svg",{style:{height:35,width:35},viewBox:"0 0 35 35",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[we.jsxs("g",{fill:"rgba(0,0,0,.2)",transform:"matrix(1, 0, 0, 1, -11.999999046325684, -8.406899452209473)",children:[we.jsx("path",{d:"m12 24.4219v-16.015l11.591 11.619h-6.781l-.411.124z"}),we.jsx("path",{d:"m21.0845 25.0962-3.605 1.535-4.682-11.089 3.686-1.553z"})]}),we.jsxs("g",{fill:"white",transform:"matrix(1, 0, 0, 1, -11.999999046325684, -8.406899452209473)",children:[we.jsx("path",{d:"m12 24.4219v-16.015l11.591 11.619h-6.781l-.411.124z"}),we.jsx("path",{d:"m21.0845 25.0962-3.605 1.535-4.682-11.089 3.686-1.553z"})]}),we.jsxs("g",{fill:n,transform:"matrix(1, 0, 0, 1, -11.999999046325684, -8.406899452209473)",children:[we.jsx("path",{d:"m19.751 24.4155-1.844.774-3.1-7.374 1.841-.775z"}),we.jsx("path",{d:"m13 10.814v11.188l2.969-2.866.428-.139h4.768z"})]})]})}const Zn={position:"absolute",top:0,left:0,bottom:0,right:0},Qo={overflow:"hidden",pointerEvents:"none",userSelect:"none"},Ko=99999;de.Cursors=Yo,de.InstantReact=Hn,de.InstantReactWeb=Jt,de.i=mo,de.id=pe,de.init=qo,de.init_experimental=zo,de.lookup=ri,de.tx=oi,Object.defineProperty(de,Symbol.toStringTag,{value:"Module"})});
